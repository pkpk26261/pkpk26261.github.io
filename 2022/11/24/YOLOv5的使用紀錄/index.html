<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="3Gg_DXWjGio6FEIB-ARrwaMbjfLismSD4kKjoMkCVV8">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-loading-bar.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"pkpk26261.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","width":260,"display":"post","padding":18,"offset":18,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#FFFFFF","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":true,"preload":true},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"fadeIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="YOLOv5 æ°¸æˆç´€éŒ„å­¸ç¿’çš„åœ°æ–¹ï¼ YOLOv7 ä½¿ç”¨å·¥æ¥­ç›¸æ©Ÿæ™‚æœƒå‡ºç¾ä»¥ä¸‹å ±éŒ¯ï¼š1&#x2F;1: 0...  success (640x480 at 0.00 FPS).ï¼Œ 0.00 FPSè¡¨ç¤ºç„¡æ³•å³æ™‚æ›´æ–°ç•«é¢ã€‚YOLOv5 è·Ÿ YOLOv7 çš„ä½¿ç”¨æŒ‡ä»¤ä»£ç¢¼é¡ä¼¼ï¼Œç”±æ–¼ YOLOv7 ç„¡æ³•ç”¨å·¥æ¥­ç›¸æ©Ÿå³æ™‚è¾¨è­˜ï¼Œæ‰€ä»¥æˆ‘æ”¹ç”¨ YOLOv5 ä¾†åšä¹‹å¾Œçš„ç ”ç©¶ã€‚                    YOLOv5-ul">
<meta property="og:type" content="article">
<meta property="og:title" content="YOLOv5 çš„ ä½¿ç”¨ç´€éŒ„">
<meta property="og:url" content="https://pkpk26261.github.io/2022/11/24/YOLOv5%E7%9A%84%E4%BD%BF%E7%94%A8%E7%B4%80%E9%8C%84/index.html">
<meta property="og:site_name" content="æ°¸æˆçš„å­¸ç¿’éƒ¨è½æ ¼">
<meta property="og:description" content="YOLOv5 æ°¸æˆç´€éŒ„å­¸ç¿’çš„åœ°æ–¹ï¼ YOLOv7 ä½¿ç”¨å·¥æ¥­ç›¸æ©Ÿæ™‚æœƒå‡ºç¾ä»¥ä¸‹å ±éŒ¯ï¼š1&#x2F;1: 0...  success (640x480 at 0.00 FPS).ï¼Œ 0.00 FPSè¡¨ç¤ºç„¡æ³•å³æ™‚æ›´æ–°ç•«é¢ã€‚YOLOv5 è·Ÿ YOLOv7 çš„ä½¿ç”¨æŒ‡ä»¤ä»£ç¢¼é¡ä¼¼ï¼Œç”±æ–¼ YOLOv7 ç„¡æ³•ç”¨å·¥æ¥­ç›¸æ©Ÿå³æ™‚è¾¨è­˜ï¼Œæ‰€ä»¥æˆ‘æ”¹ç”¨ YOLOv5 ä¾†åšä¹‹å¾Œçš„ç ”ç©¶ã€‚                    YOLOv5-ul">
<meta property="og:locale" content="zh_TW">
<meta property="og:image" content="https://raw.githubusercontent.com/ultralytics/assets/master/yolov5/v70/splash.png">
<meta property="og:image" content="https://i.imgur.com/rim65X6.png">
<meta property="og:image" content="https://i.imgur.com/dHFn8uL.png">
<meta property="og:image" content="https://i.imgur.com/tcUokqe.png">
<meta property="og:image" content="https://i.imgur.com/Cbisw1g.png">
<meta property="og:image" content="https://i.imgur.com/yvooxSt.png">
<meta property="og:image" content="https://i.imgur.com/hrfw7O7.png">
<meta property="og:image" content="https://i.imgur.com/ADAsxOG.png">
<meta property="og:image" content="https://i.imgur.com/ThJ9DWD.png">
<meta property="og:image" content="https://i.imgur.com/mMfnTc3.png">
<meta property="og:image" content="https://i.imgur.com/SlAnxDn.png">
<meta property="og:image" content="https://i.imgur.com/Si6fOM4.png">
<meta property="og:image" content="https://i.imgur.com/B2QNOsP.png">
<meta property="og:image" content="https://i.imgur.com/PmvGt4I.png">
<meta property="og:image" content="https://i.imgur.com/Hy5JDYv.png">
<meta property="og:image" content="https://i.imgur.com/kQQMQhs.png">
<meta property="og:image" content="https://i.imgur.com/JJc2Ksx.png">
<meta property="og:image" content="https://i.imgur.com/wELOdNS.png">
<meta property="og:image" content="https://i.imgur.com/Alh3Pv5.png">
<meta property="article:published_time" content="2022-11-24T12:08:42.000Z">
<meta property="article:modified_time" content="2022-11-24T12:08:46.000Z">
<meta property="article:author" content="Yong Cheng">
<meta property="article:tag" content="Python">
<meta property="article:tag" content="YOLO">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/ultralytics/assets/master/yolov5/v70/splash.png">

<link rel="canonical" href="https://pkpk26261.github.io/2022/11/24/YOLOv5%E7%9A%84%E4%BD%BF%E7%94%A8%E7%B4%80%E9%8C%84/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-TW'
  };
</script>


<script>
    (function(){
        if(''){
            if (prompt('è«‹è¼¸å…¥å¯†ç¢¼') !== ''){
                alert('å¯†ç¢¼ä¸æ­£ç¢ºï¼è«‹è¨ªå•ä½œè€…ç´¢å–');
                history.back();
            }
        }
    })();
</script>
  <title>YOLOv5 çš„ ä½¿ç”¨ç´€éŒ„ | æ°¸æˆçš„å­¸ç¿’éƒ¨è½æ ¼</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ›å°èˆªæ¬„">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">æ°¸æˆçš„å­¸ç¿’éƒ¨è½æ ¼</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">é€™è£¡æœƒè¨˜éŒ„æ°¸æˆå­¸ç¿’çš„ä¸€éƒ¨åˆ†</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é </a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>é—œæ–¼</a>

  </li>
        <li class="menu-item menu-item-ç­†æœ­">

    <a href="/pen/" rel="section"><i class="fas fa-pen-nib fa-fw"></i>ç­†æœ­</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>æ¨™ç±¤</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†é¡</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>æ­¸æª”</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœå°‹
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="æœå°‹..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/pkpk26261" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-TW">
    <link itemprop="mainEntityOfPage" href="https://pkpk26261.github.io/2022/11/24/YOLOv5%E7%9A%84%E4%BD%BF%E7%94%A8%E7%B4%80%E9%8C%84/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/lanlancat.gif">
      <meta itemprop="name" content="Yong Cheng">
      <meta itemprop="description" content="æˆ‘ä¸€æ—¦æ±ºå®šï¼Œå°±ç‚ºäº†å¤¢å‰é€²ğŸ‘">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="æ°¸æˆçš„å­¸ç¿’éƒ¨è½æ ¼">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          YOLOv5 çš„ ä½¿ç”¨ç´€éŒ„
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">ç™¼è¡¨æ–¼</span>
              

              <time title="å‰µå»ºæ™‚é–“ï¼š2022-11-24 20:08:42 / ä¿®æ”¹æ™‚é–“ï¼š20:08:46" itemprop="dateCreated datePublished" datetime="2022-11-24T20:08:42+08:00">2022-11-24</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†é¡æ–¼</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python-%E7%A8%8B%E5%BC%8F%E8%AA%9E%E8%A8%80%E5%AD%B8%E7%BF%92/" itemprop="url" rel="index"><span itemprop="name">Python ç¨‹å¼èªè¨€å­¸ç¿’</span></a>
                </span>
                  ï¼Œ
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python-%E7%A8%8B%E5%BC%8F%E8%AA%9E%E8%A8%80%E5%AD%B8%E7%BF%92/YOLO/" itemprop="url" rel="index"><span itemprop="name">YOLO</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>YOLOv5 æ°¸æˆç´€éŒ„å­¸ç¿’çš„åœ°æ–¹ï¼</p>
<p><code>YOLOv7</code> ä½¿ç”¨å·¥æ¥­ç›¸æ©Ÿæ™‚æœƒå‡ºç¾ä»¥ä¸‹å ±éŒ¯ï¼š<code>1/1: 0...  success (640x480 at 0.00 FPS).</code>ï¼Œ <font color="red">0.00 FPS</font>è¡¨ç¤ºç„¡æ³•å³æ™‚æ›´æ–°ç•«é¢ã€‚<br><code>YOLOv5</code> è·Ÿ <code>YOLOv7</code> çš„ä½¿ç”¨æŒ‡ä»¤ä»£ç¢¼é¡ä¼¼ï¼Œç”±æ–¼ <code>YOLOv7</code> <font color="red">ç„¡æ³•ç”¨å·¥æ¥­ç›¸æ©Ÿå³æ™‚è¾¨è­˜</font>ï¼Œæ‰€ä»¥æˆ‘æ”¹ç”¨ <code>YOLOv5</code> ä¾†åšä¹‹å¾Œçš„ç ”ç©¶ã€‚</p>
  <p>
    <a align="center" href="https://ultralytics.com/yolov5" target="_blank">
      <img width="1680" src="https://raw.githubusercontent.com/ultralytics/assets/master/yolov5/v70/splash.png"></a>
  </p>

<p><font color="blue">YOLOv5-ultralytics-Github</font>ï¼š<a target="_blank" rel="noopener" href="https://github.com/ultralytics/yolov5">https://github.com/ultralytics/yolov5</a>  ï¼ˆ<a target="_blank" rel="noopener" href="https://github.com/ultralytics/yolov5/blob/master/.github/README_cn.md">Chinese ä¸­æ–‡ç°¡é«”èªªæ˜</a>ï¼‰<br>ï¼ˆè‹¥æœ‰æ–°çš„äº†è§£ï¼ŒæœƒæŒçºŒæ›´æ–°ï½ï¼‰</p>
<center>â¬‡â¬‡â¬‡æ–‡ç« é–‹å§‹â¬‡â¬‡â¬‡</center>
<span id="more"></span>

<h1 id="é–‹å§‹"><a href="#é–‹å§‹" class="headerlink" title="é–‹å§‹"></a>é–‹å§‹</h1><ul>
<li>ä½¿ç”¨<code>Anaconda</code>è»Ÿé«”ï¼Œä¾†é€²è¡Œæœ¬æ¬¡ç ”ç©¶ã€‚</li>
<li>è‡³<code>Anaconda</code>å®˜ç¶²ä¸‹è¼‰å®‰è£æœ€æ–°ç‰ˆæœ¬ï¼š<a target="_blank" rel="noopener" href="https://www.anaconda.com/products/distribution">https://www.anaconda.com/products/distribution</a></li>
<li>å®‰è£å®Œæˆå¾Œï¼Œä½¿ç”¨ <code>Anaconda Prompt (anaconda3)</code> ä¾†å»ºç«‹YOLOv5ç’°å¢ƒã€‚</li>
</ul>
<h1 id="å»ºç«‹YOLOv5ç’°å¢ƒ"><a href="#å»ºç«‹YOLOv5ç’°å¢ƒ" class="headerlink" title="å»ºç«‹YOLOv5ç’°å¢ƒ"></a>å»ºç«‹YOLOv5ç’°å¢ƒ</h1><ol>
<li><p>å»ºç«‹ <code>Python æ–°ç’°å¢ƒ</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda create -n yolov5-py3.9 python=3.9.13</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda activate yolov5-py3.9</span><br></pre></td></tr></table></figure>
</li>
<li><p>è‡³ <code>YOLOv5 çš„ Github</code> ä¸‹è¼‰ï¼š<a target="_blank" rel="noopener" href="https://github.com/ultralytics/yolov5">https://github.com/ultralytics/yolov5</a><br><img src="https://i.imgur.com/rim65X6.png"></p>
</li>
<li><p>è§£å£“ç¸®ç¬¬2æ­¥é©Ÿä¸‹è¼‰çš„<code>yolov5-master.zip</code>çš„æª”æ¡ˆ</p>
</li>
<li><p>ç”±æ–¼<code>YOLO</code>å„ç‰ˆæœ¬éƒ½æœƒæœ‰æä¾›å®‰è£æ¨¡çµ„æ¸…å–®ï¼Œcd è‡³ <code>yolov5-master</code> çš„è³‡æ–™å¤¾ï¼Œå°±å¯ä»¥å®‰è£ YOLOv5 æ‰€éœ€å¥—ä»¶</p>
 <details>
 <summary>ï¼ˆé»æ“Šå±•é–‹ï¼‰<font color="red">å¦‚æœæœ‰å ±éŒ¯ `warning: ignore distutils configs in setup.cfg due to encoding errors.`</font></summary>
 è§£æ±ºè¾¦æ³•ï¼š
 <img width="850" src="https://i.imgur.com/dHFn8uL.png">
 </details>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install -r requirements.txt</span><br></pre></td></tr></table></figure>
<img width="640" src="https://i.imgur.com/tcUokqe.png">
</li>
<li><p>é–‹å•Ÿ<code>Anaconda Navigator</code>ï¼Œåˆ‡æ›ç’°å¢ƒåˆ°å‰›å‰›å»ºç«‹çš„<code>yolov5</code><br><img src="https://i.imgur.com/Cbisw1g.png" alt="Anaconda Navigator"></p>
</li>
<li><p>åœ¨ä¸Šå€‹æ­¥é©Ÿçš„<code>Anaconda Navigator</code>ä»‹é¢ä¸‹å®‰è£ï¼š</p>
</li>
</ol>
<ul>
<li><blockquote>
<p><code>Notebook</code>ã€<code>CMD.exe Prompt</code><br>(è‹¥æœ‰å…¶ä»–éœ€è¦ï¼Œå¯åœ¨å®‰è£å…¶å®ƒçš„è»Ÿä»¶)</p>
</blockquote>
</li>
</ul>
<ol start="7">
<li>å®‰è£<code>Pytorch-cuda</code>ï¼Œå®˜ç¶²ï¼š<a target="_blank" rel="noopener" href="https://pytorch.org/">https://pytorch.org/</a><br><code>Pytorch</code>å®˜ç¶²æ­·å²ç‰ˆæœ¬ï¼š<a target="_blank" rel="noopener" href="https://pytorch.org/get-started/previous-versions/">https://pytorch.org/get-started/previous-versions/</a><br><font color="red">æˆ‘é¸æ“‡å®‰è£æœ€æ–°ç‰ˆ<code>Stable (1.13.1)</code>çš„Pytorchç‰ˆæœ¬ã€‚</font></li>
</ol>
<blockquote>
<p><img src="https://i.imgur.com/yvooxSt.png"></p>
<blockquote>
<ul>
<li>å®‰è£æŒ‡ä»¤ï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda install pytorch torchvision torchaudio pytorch-cuda=11.7 -c pytorch -c nvidia</span><br></pre></td></tr></table></figure></li>
<li>ç¤ºæ„åœ–ï¼š<br>  <img src="https://i.imgur.com/hrfw7O7.png"></li>
</ul>
</blockquote>
</blockquote>
<ol start="8">
<li><p>é€™æ¨£ <code>YOLOv5</code> çš„ç’°å¢ƒå°±å»ºç«‹å®Œæˆäº†ï¼</p>
</li>
<li><p>ä»¥ä¸‹æ˜¯æˆ‘å€‹äººéœ€è¦å®‰è£çš„åŒ…ï¼Œåœ¨é€™åšå€‹ç´€éŒ„ã€‚</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install PyQt5</span><br></pre></td></tr></table></figure>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install pyqt5-tools</span><br></pre></td></tr></table></figure>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install eventlet</span><br></pre></td></tr></table></figure>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install chardet</span><br></pre></td></tr></table></figure></li>
</ol>
<ul>
<li><p><font color="red">å‚™è¨»ï¼š</font></p>
<p>  <code>QT5 Designer</code>ä¸­æ–‡ä½¿ç”¨ä»‹é¢ä½ç½®ï¼š</p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\ä½¿ç”¨è€…\anaconda3\envs\ç’°å¢ƒåç¨±\Lib\site-packages\qt5_applications\Qt\bin\`designer.exe`</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h1 id="ä½¿ç”¨labelimgæ¡†åœ–ç‰‡å»ºç«‹æ¨£æœ¬"><a href="#ä½¿ç”¨labelimgæ¡†åœ–ç‰‡å»ºç«‹æ¨£æœ¬" class="headerlink" title="ä½¿ç”¨labelimgæ¡†åœ–ç‰‡å»ºç«‹æ¨£æœ¬"></a>ä½¿ç”¨labelimgæ¡†åœ–ç‰‡å»ºç«‹æ¨£æœ¬</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install labelimg</span><br></pre></td></tr></table></figure>

<ul>
<li>åŸ·è¡Œæ™‚ï¼Œåœ¨<code>Anaconda Prompt (yolov5)</code>ä¸Šè¼¸å…¥<code>labelimg</code>ï¼Œæœƒè·³å‡ºä»¥ä¸‹ç•«é¢ï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">labelimg</span><br></pre></td></tr></table></figure>

<blockquote>
<p><img src="https://i.imgur.com/ADAsxOG.png" alt="ç¤ºæ„åœ–"></p>
<ul>
<li><code>Open Dir</code> æ‰“é–‹è¦è¨“ç·´åœ–ç‰‡çš„è³‡æ–™å¤¾</li>
<li><code>Change Save Dir</code> æ”¾ç½®å„²å­˜labelsçš„è³‡æ–™å¤¾<br>è©³é–±ï¼š<a target="_blank" rel="noopener" href="https://blog.csdn.net/klaus_x/article/details/106854136">Yoloæ¨™è¨»å·¥å…·-labelImgçš„è©³ç´°ä½¿ç”¨</a></li>
</ul>
</blockquote>
</li>
</ul>
<hr>
<h1 id="å»ºç«‹æ–°å¢AIè¾¨è­˜çš„åœ–ç‰‡æ¨£æœ¬"><a href="#å»ºç«‹æ–°å¢AIè¾¨è­˜çš„åœ–ç‰‡æ¨£æœ¬" class="headerlink" title="å»ºç«‹æ–°å¢AIè¾¨è­˜çš„åœ–ç‰‡æ¨£æœ¬"></a>å»ºç«‹æ–°å¢AIè¾¨è­˜çš„åœ–ç‰‡æ¨£æœ¬</h1><p>åˆ©ç”¨å·¥æ¥­ç›¸æ©Ÿæ‹æ”å½±ç‰‡ï¼Œå°‡å½±ç‰‡çš„æ¯ä¸€å¹€æ•¸çš„ç•«é¢æ“·å–æˆç…§ç‰‡ï¼Œæ¯ä¸€å¼µä»¥åç¨±+ç·¨è™Ÿæ•¸å­—å­˜åœ¨å½±åƒè³‡æ–™å¤¾ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> shutil</span><br><span class="line"></span><br><span class="line">a=<span class="built_in">input</span>(<span class="string">&quot;è«‹è¼¸å…¥è³‡æ–™å¤¾åç¨±(è«‹ä»¥è‹±æ–‡å‘½å)ï¼š&quot;</span>)</span><br><span class="line">b=<span class="built_in">input</span>(<span class="string">&quot;è«‹è¼¸å…¥å¼µæ•¸ï¼š&quot;</span>)</span><br><span class="line">enter=<span class="built_in">int</span>(b)</span><br><span class="line"><span class="comment"># ----------</span></span><br><span class="line"><span class="comment"># é–‹å•Ÿæ”åƒé ­</span></span><br><span class="line">cap = cv2.VideoCapture(<span class="number">0</span>) <span class="comment"># é¸æ“‡é‹è¡Œæ”å½±æ©Ÿ(é è¨­ç‚º0)</span></span><br><span class="line"><span class="comment"># è¦–è¨Šå¤§å°è¨­å®šï¼Œç²å–å¹€å¯¬åº¦ï¼Œç²å–å¹€é«˜åº¦</span></span><br><span class="line">sz = (<span class="built_in">int</span>(cap.get(cv2.CAP_PROP_FRAME_WIDTH)), <span class="built_in">int</span>(cap.get(cv2.CAP_PROP_FRAME_HEIGHT)))</span><br><span class="line">fps = <span class="number">30</span></span><br><span class="line"><span class="comment"># è¼¸å‡ºæ ¼å¼</span></span><br><span class="line">fourcc = cv2.VideoWriter_fourcc(*<span class="string">&#x27;mp4v&#x27;</span>)</span><br><span class="line"><span class="comment"># open and set props</span></span><br><span class="line">vout = cv2.VideoWriter()</span><br><span class="line">vout.<span class="built_in">open</span>(a+<span class="string">&#x27;.mp4&#x27;</span>, fourcc, fps, sz, <span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">cnt = <span class="number">1</span></span><br><span class="line"><span class="keyword">while</span> cnt &lt;= enter:</span><br><span class="line">    _, frame = cap.read()</span><br><span class="line">    <span class="comment"># putTextè¼¸å‡ºåˆ°è¦–è¨Šä¸Šï¼Œå„å¼•æ•¸ä¾æ¬¡æ˜¯ï¼šç…§ç‰‡/æ–°å¢çš„æ–‡å­—/å·¦ä¸Šè§’åº§æ¨™/å­—å‹/å­—å‹å¤§å°/é¡è‰²/å­—å‹ç²—ç´°</span></span><br><span class="line">    cv2.putText(frame, <span class="built_in">str</span>(cnt), (<span class="number">10</span>, <span class="number">20</span>), cv2.FONT_HERSHEY_PLAIN, <span class="number">1</span>, (<span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>), <span class="number">1</span>, cv2.LINE_AA)</span><br><span class="line">    vout.write(frame)</span><br><span class="line">    cnt += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    cv2.imshow(<span class="string">&#x27;vidio&#x27;</span>, frame)</span><br><span class="line">    cv2.waitKey(<span class="number">30</span>)</span><br><span class="line"></span><br><span class="line">vout.release()</span><br><span class="line">cap.release()</span><br><span class="line"><span class="comment"># ----------------------------------------</span></span><br><span class="line">video_path = a+<span class="string">&#x27;.mp4&#x27;</span></span><br><span class="line">output_folder = <span class="string">&#x27;./&#x27;</span>+a+<span class="string">&#x27;/&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> os.path.isdir(output_folder):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;åˆªé™¤è³‡æ–™å¤¾: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(output_folder))</span><br><span class="line">    shutil.rmtree(output_folder)</span><br><span class="line">	 </span><br><span class="line">os.mkdir(output_folder)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;æ–°å»ºè³‡æ–™å¤¾: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(output_folder))</span><br><span class="line"><span class="comment"># ----------------------------------------</span></span><br><span class="line"><span class="comment"># å»ºç«‹åœ–ç‰‡</span></span><br><span class="line">vc = cv2.VideoCapture(video_path)</span><br><span class="line">fps = vc.get(cv2.CAP_PROP_FPS)</span><br><span class="line">frame_count = <span class="built_in">int</span>(vc.get(cv2.CAP_PROP_FRAME_COUNT))</span><br><span class="line"><span class="comment">#print(frame_count)</span></span><br><span class="line">video = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> idx <span class="keyword">in</span> <span class="built_in">range</span>(frame_count):</span><br><span class="line">    vc.<span class="built_in">set</span>(<span class="number">1</span>, idx)</span><br><span class="line">    ret, frame = vc.read()</span><br><span class="line">    height, width, layers = frame.shape</span><br><span class="line">    size = (width, height)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> frame <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        file_name = <span class="string">&#x27;&#123;&#125;&#123;&#125;&#123;:04d&#125;.jpg&#x27;</span>.<span class="built_in">format</span>(output_folder,a,idx+<span class="number">1</span>)</span><br><span class="line">        cv2.imwrite(file_name, frame)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\rprocess: &#123;&#125;/&#123;&#125;&quot;</span>.<span class="built_in">format</span>(idx+<span class="number">1</span> , frame_count), end = <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">vc.release()</span><br><span class="line"><span class="comment"># ----------------------------------------</span></span><br><span class="line"><span class="comment"># ç§»å‹•å½±ç‰‡åˆ°è³‡æ–™å¤¾</span></span><br><span class="line">shutil.move(<span class="built_in">str</span>(a)+<span class="string">&#x27;.mp4&#x27;</span>,<span class="built_in">str</span>(a))</span><br></pre></td></tr></table></figure>

<p>åƒè€ƒï¼š<a target="_blank" rel="noopener" href="https://www.wongwonggoods.com/python/python_opencv/opencv-get-images-from-video/">ã€OpenCVã€‘OpenCV åˆ©ç”¨ python OpenCV å°‡ä¸€éƒ¨å½±ç‰‡æ‹†æˆä¸€å¼µå¼µåœ–ç‰‡ sample code (å…§é™„ç¨‹å¼ç¢¼) get images from video</a><br>è©³é–±ï¼š<a href="https://pkpk26261.github.io/2020/01/15/%E4%BD%BF%E7%94%A8%E7%9B%B8%E6%A9%9F%E6%94%9D%E5%BD%B1%E6%88%AA%E5%9C%96%E5%8F%96AI%E8%BE%A8%E8%AD%98%E6%A8%A3%E6%9C%AC/#more">ã€æ°¸æˆçš„å­¸ç¿’éƒ¨è½æ ¼ã€‘ä½¿ç”¨ç›¸æ©Ÿæ”å½±æˆªåœ–å–AIè¾¨è­˜æ¨£æœ¬</a><br>é€™ä¸€ç¯‡æ˜¯æˆ‘éå»æ‰€å¯«çš„ä¸€ç¯‡æ–‡ç« ã€‚</p>
<hr>
<h1 id="è¨“ç·´-amp-é©—è­‰åœ–ç‰‡"><a href="#è¨“ç·´-amp-é©—è­‰åœ–ç‰‡" class="headerlink" title="è¨“ç·´&amp;é©—è­‰åœ–ç‰‡"></a>è¨“ç·´&amp;é©—è­‰åœ–ç‰‡</h1><p>å°‡è¦è¾¨è­˜çš„åœ–ç‰‡åº«ï¼Œåˆ†ç‚ºå…©å¤§é¡ï¼š</p>
<ol>
<li>è¨“ç·´æ¨¡å‹<br>åœ–ç‰‡è¶Šå¤šè¶Šå¥½ï¼Œä½†ç›¸å°çš„è¨“ç·´æ™‚é–“æœƒè¶Šä¹…ã€‚<br>å°‡è¨“ç·´åœ–æ¡ˆæ”¾åœ¨<code>.\yolov5-master\data\train</code>è£¡é¢</li>
</ol>
<ul>
<li>ç¤ºæ„åœ–ï¼š<br><img  src="https://i.imgur.com/ThJ9DWD.png" style="float:left"><br><br><br><br></li>
</ul>
<ol start="2">
<li>é©—è­‰æ¨¡å‹<br>åœ–ç‰‡è‡³å°‘ç‚º20å¼µä»¥ä¸Šã€‚<br>å°‡è¨“ç·´åœ–æ¡ˆæ”¾åœ¨<code>.\yolov5-master\data\val</code>è£¡é¢</li>
</ol>
<ul>
<li>ç¤ºæ„åœ–ï¼š<br><img  src="https://i.imgur.com/mMfnTc3.png" style="float:left"><br><br><br><br></li>
</ul>
<p>é€šå¸¸è¨“ç·´å’Œé©—è­‰çš„å¼µæ•¸æ¯”ä¾‹ï¼Œå¤§æ¦‚ç‚º <code>7:3</code> æˆ– <code>8:2</code>ã€‚</p>
<hr>
<h1 id="æ¡†å¥½çš„åœ–ç‰‡ã€è¨“ç·´ã€‘"><a href="#æ¡†å¥½çš„åœ–ç‰‡ã€è¨“ç·´ã€‘" class="headerlink" title="æ¡†å¥½çš„åœ–ç‰‡ã€è¨“ç·´ã€‘"></a>æ¡†å¥½çš„åœ–ç‰‡ã€è¨“ç·´ã€‘</h1><h2 id="è¨“ç·´è‡ªå®šç¾©æ•¸æ“š"><a href="#è¨“ç·´è‡ªå®šç¾©æ•¸æ“š" class="headerlink" title="è¨“ç·´è‡ªå®šç¾©æ•¸æ“š"></a>è¨“ç·´è‡ªå®šç¾©æ•¸æ“š</h2><p><code>YOLOv5</code> æ¨¡å‹å¿…é ˆåœ¨æ¨™è¨˜æ•¸æ“šä¸Šé€²è¡Œè¨“ç·´ï¼Œä»¥ä¾¿å­¸ç¿’è©²æ•¸æ“šä¸­çš„å°åƒé¡åˆ¥ã€‚</p>
<ol>
<li><p>å°‡<code>.\yolov5-master\data\coco.yaml</code>çš„æª”æ¡ˆè¤‡è£½ï¼Œå°‡æª”åå–ç‚º<code>custom_data.yaml</code>ï¼Œç„¶å¾Œç·¨è¼¯æª”æ¡ˆï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">train:</span> <span class="string">./data/train</span>  <span class="comment"># è¨“ç·´çš„åœ–ç‰‡&amp;labelsçš„è³‡æ–™å¤¾ç´¢å¼•</span></span><br><span class="line"><span class="attr">val:</span> <span class="string">./data/val</span>      <span class="comment"># é©—è­‰çš„åœ–ç‰‡&amp;labelsçš„è³‡æ–™å¤¾ç´¢å¼•</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># number of classes  # æ•¸å­—ç‚ºè¨“ç·´åœ–ç‰‡é¡åˆ¥çš„æ•¸é‡</span></span><br><span class="line"><span class="attr">nc:</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># class names</span></span><br><span class="line"><span class="attr">names:</span> [ <span class="string">&#x27;bad&#x27;</span> ]     <span class="comment"># é¡åˆ¥åç¨±çš„è¨­ç½®</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>å°‡<code>.\yolov5-master\models\yolov5s.yaml</code>çš„æª”æ¡ˆè¤‡è£½ï¼Œå°‡æª”åå–ç‚º<code>yolov5s-custom.yaml</code>ï¼Œç„¶å¾Œç·¨è¼¯æª”æ¡ˆï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># parameters</span></span><br><span class="line"><span class="attr">nc:</span> <span class="number">1</span>  <span class="comment"># number of classes # æ•¸å­—ç‚ºè¨“ç·´åœ–ç‰‡é¡åˆ¥çš„æ•¸é‡</span></span><br><span class="line"><span class="attr">depth_multiple:</span> <span class="number">0.33</span>  <span class="comment"># model depth multiple # æ¨¡å‹æ·±åº¦å€æ•¸</span></span><br><span class="line"><span class="attr">width_multiple:</span> <span class="number">0.25</span>  <span class="comment"># layer channel multiple # å±¤é€šé“å¤š</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>åˆ°<code>YOLOv5-Github</code>çš„<code>Releases</code>åœ°æ–¹ä¸‹è¼‰å…©å€‹æª”æ¡ˆï¼ˆ<code>yolov5s.pt</code>å’Œ<code>yolov5s.pt</code>ï¼‰ï¼Œå°‡æª”æ¡ˆå­˜æ”¾åœ¨<code>.\yolov5-master\weights</code>ç›®éŒ„ä¸‹ï¼š</p>
 <details>
 <summary><font color="red">ç¤ºæ„åœ–ï¼ˆé»æ“Šå±•é–‹ï¼‰</font></summary>
 è§£æ±ºè¾¦æ³•ï¼š
 <img width="850" src="https://i.imgur.com/SlAnxDn.png">
 </details>

<p> ï¼ˆå¦‚æœæ²’æœ‰<code>.\yolov5-master\weights</code>ç›®éŒ„ï¼Œè«‹è‡ªè¡Œå»ºç«‹ä¸€å€‹<code>weights</code>ç›®éŒ„ï¼‰<br> ä¸‹è¼‰é€£çµï¼š<a target="_blank" rel="noopener" href="https://github.com/ultralytics/yolov5/releases/tag/v7.0">https://github.com/ultralytics/yolov5/releases/tag/v7.0</a></p>
<blockquote>
<p><img src="https://i.imgur.com/Si6fOM4.png"></p>
</blockquote>
</li>
</ol>
<hr>
<h2 id="é¸æ“‡å‹è™Ÿ"><a href="#é¸æ“‡å‹è™Ÿ" class="headerlink" title="é¸æ“‡å‹è™Ÿ"></a>é¸æ“‡å‹è™Ÿ</h2><p>é¸æ“‡ä¸€å€‹é è¨“ç·´æ¨¡å‹é–‹å§‹è¨“ç·´ã€‚åœ¨é€™è£¡ï¼Œæˆ‘å€‘é¸æ“‡<code>YOLOv5s</code>ï¼Œç¬¬äºŒå°å’Œæœ€å¿«çš„å¯ç”¨æ¨¡å‹ã€‚è«‹åƒé–±READMEè¡¨ï¼Œäº†è§£æ‰€æœ‰å‹è™Ÿçš„å®Œæ•´æ¯”è¼ƒã€‚<br><img src="https://i.imgur.com/B2QNOsP.png"><br><img src="https://i.imgur.com/PmvGt4I.png"></p>
<h2 id="é–‹å§‹è¨“ç·´"><a href="#é–‹å§‹è¨“ç·´" class="headerlink" title="é–‹å§‹è¨“ç·´"></a>é–‹å§‹è¨“ç·´</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python train.py --workers 1 --device 0 --imgsz 640 --data data/custom_data.yaml --hyp data/hyps/hyp.scratch-low.yaml --cfg models/yolov5s-custom.yaml --weights weights/yolov5s.pt --name train-run --project runs/train --batch-size 16 --epochs 300</span><br></pre></td></tr></table></figure>
<blockquote>
<p>è¨“ç·´å®Œä¹‹å¾Œï¼Œå°‡æœ€æ–°çš„<code>.\runs\train</code>çš„ç›®éŒ„ä¸‹ï¼Œ<code>yolov5s-train</code>æœ€æ–°è³‡æ–™å¤¾ä¹‹<code>.\weights\best.pt</code>çš„æª”æ¡ˆè¤‡è£½åˆ°ä¸»ç›®éŒ„<code>.\yolov5-master</code>ä¹‹ä¸‹ï¼<br><font color="red">é€™æ¨£æ‰èƒ½å¾€ä¸‹ä¸€å€‹ detect (æª¢æ¸¬) æ­¥é©Ÿï¼ï¼ï¼</font>å› ç‚º detect (æª¢æ¸¬) éœ€è¦è®€å–è¨“ç·´å®Œå¾Œçš„ <code>best.pt</code> æª”æ¡ˆã€‚</p>
</blockquote>
<ul>
<li><p>å¦‚ç¤ºæ„åœ–ï¼š<br><img src="https://i.imgur.com/Hy5JDYv.png"></p>
<p><code>--weights</code>ï¼šåˆå§‹weightsè·¯å¾‘ã€‚exï¼š<code>--weights yolov5s.pt</code><br><code>--cfg</code>ï¼šmodel.yamlè·¯å¾‘ã€‚ exï¼š<code>--cfg cfg/training/yolov5s-custom.yaml</code><br><code>--data</code>ï¼šdata.yamlè·¯å¾‘ã€‚exï¼š<code>--data data/custom_data.yaml</code><br><code>--hyp</code>ï¼šhyperparametersè·¯å¾‘ã€‚exï¼š<code>--hyp data/hyp.scratch.custom.yaml</code><br><code>--epochs</code>ï¼šè¨“ç·´å›åˆï¼Œé è¨­ç‚º100å›åˆã€‚exï¼š<code>--epochs 200</code><br><code>--batch-size</code>ï¼šé è¨­&#x3D;16, æ‰€æœ‰ GPU çš„ç¸½æ‰¹å¤§å°ã€‚exï¼š<code>--batch-size 11</code><br><code>--img-size</code>ï¼š[è¨“ç·´, æ¸¬è©¦] åœ–ç‰‡å¤§å°ï¼Œé è¨­ç‚ºã€640,640ã€‘ã€‚exï¼š<code>--img 640 640</code><br><code>--workers</code>ï¼šè¨“ç·´è³‡æ–™è®€å–å·¥ä½œçš„æœ€å¤§æ•¸é‡ã€‚exï¼š<code>--workers 1</code><br><code>--name</code>ï¼šå°‡è¨“ç·´çµæœè³‡æ–™å¤¾åç¨±å‘½åã€‚exï¼š<code>--name yolov5s-train</code><br><code>--project</code>ï¼šå°‡è¨“ç·´çµæœä¿å­˜åˆ°è‡ªè¨‚è³‡æ–™å¤¾ã€‚exï¼š<code>--project runs/train</code><br><code>--device</code> ï¼šé è¨­0ï¼Œå¯èª¿æ•´0,1,2,3 or cpuã€‚exï¼š<code>--device 0</code></p>
<ul>
<li><font color="red">ï¼ˆæŸ¥çœ‹æ›´å¤šæŒ‡ä»¤èªªæ˜ï¼‰ï¼š</font><blockquote>
<p>åœ¨ <code>Anaconda Prompt (yolov5)</code> ä¸Šè¼¸å…¥ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python train.py -h</span><br></pre></td></tr></table></figure>

<p><font color="red" size="6px"> â— è¨“ç·´éç¨‹ï¼Œè«‹è€å¿ƒç­‰å€™ï½ </font><br><img src="https://i.imgur.com/kQQMQhs.png"></p>
</blockquote>
</li>
</ul>
</li>
</ul>
<h2 id="train-py"><a href="#train-py" class="headerlink" title="train.py"></a>train.py</h2><details>
<summary><font color="red">train.py ä¸­æ–‡ä¿®æ”¹è£œå……ï¼ˆé»æ“Šå±•é–‹ï¼‰</font></summary>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># YOLOv5 ğŸš€ by Ultralytics, GPL-3.0 license</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">åœ¨è‡ªå®šç¾©æ•¸æ“šé›†ä¸Šè¨“ç·´ YOLOv5 æ¨¡å‹ã€‚</span></span><br><span class="line"><span class="string">å¾æœ€æ–°çš„ YOLOv5 ç‰ˆæœ¬è‡ªå‹•ä¸‹è¼‰æ¨¡å‹å’Œæ•¸æ“šé›†ã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">ç”¨æ³• - å–® GPU è¨“ç·´ï¼š</span></span><br><span class="line"><span class="string">    $ python train.py --data coco128.yaml --weights yolov5s.pt --img 640  # from pretrained (recommended)</span></span><br><span class="line"><span class="string">    $ python train.py --data coco128.yaml --weights &#x27;&#x27; --cfg yolov5s.yaml --img 640  # from scratch</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">ç”¨æ³• - å¤š GPU DDP è¨“ç·´ï¼š</span></span><br><span class="line"><span class="string">    $ python -m torch.distributed.run --nproc_per_node 4 --master_port 1 train.py --data coco128.yaml --weights yolov5s.pt --img 640 --device 0,1,2,3</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">æ¨¡å‹:     https://github.com/ultralytics/yolov5/tree/master/models</span></span><br><span class="line"><span class="string">æ•¸æ“šé›†:   https://github.com/ultralytics/yolov5/tree/master/data</span></span><br><span class="line"><span class="string">æ•™ç¨‹:   https://github.com/ultralytics/yolov5/wiki/Train-Custom-Data</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> copy <span class="keyword">import</span> deepcopy</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.distributed <span class="keyword">as</span> dist</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"><span class="keyword">import</span> yaml</span><br><span class="line"><span class="keyword">from</span> torch.optim <span class="keyword">import</span> lr_scheduler</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"></span><br><span class="line">FILE = Path(__file__).resolve()</span><br><span class="line">ROOT = FILE.parents[<span class="number">0</span>]  <span class="comment"># YOLOv5 root directory</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">str</span>(ROOT) <span class="keyword">not</span> <span class="keyword">in</span> sys.path:</span><br><span class="line">    sys.path.append(<span class="built_in">str</span>(ROOT))  <span class="comment"># add ROOT to PATH</span></span><br><span class="line">ROOT = Path(os.path.relpath(ROOT, Path.cwd()))  <span class="comment"># relative</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> val <span class="keyword">as</span> validate  <span class="comment"># for end-of-epoch mAP</span></span><br><span class="line"><span class="keyword">from</span> models.experimental <span class="keyword">import</span> attempt_load</span><br><span class="line"><span class="keyword">from</span> models.yolo <span class="keyword">import</span> Model</span><br><span class="line"><span class="keyword">from</span> utils.autoanchor <span class="keyword">import</span> check_anchors</span><br><span class="line"><span class="keyword">from</span> utils.autobatch <span class="keyword">import</span> check_train_batch_size</span><br><span class="line"><span class="keyword">from</span> utils.callbacks <span class="keyword">import</span> Callbacks</span><br><span class="line"><span class="keyword">from</span> utils.dataloaders <span class="keyword">import</span> create_dataloader</span><br><span class="line"><span class="keyword">from</span> utils.downloads <span class="keyword">import</span> attempt_download, is_url</span><br><span class="line"><span class="keyword">from</span> utils.general <span class="keyword">import</span> (LOGGER, TQDM_BAR_FORMAT, check_amp, check_dataset, check_file, check_git_info,</span><br><span class="line">                           check_git_status, check_img_size, check_requirements, check_suffix, check_yaml, colorstr,</span><br><span class="line">                           get_latest_run, increment_path, init_seeds, intersect_dicts, labels_to_class_weights,</span><br><span class="line">                           labels_to_image_weights, methods, one_cycle, print_args, print_mutation, strip_optimizer,</span><br><span class="line">                           yaml_save)</span><br><span class="line"><span class="keyword">from</span> utils.loggers <span class="keyword">import</span> Loggers</span><br><span class="line"><span class="keyword">from</span> utils.loggers.comet.comet_utils <span class="keyword">import</span> check_comet_resume</span><br><span class="line"><span class="keyword">from</span> utils.loss <span class="keyword">import</span> ComputeLoss</span><br><span class="line"><span class="keyword">from</span> utils.metrics <span class="keyword">import</span> fitness</span><br><span class="line"><span class="keyword">from</span> utils.plots <span class="keyword">import</span> plot_evolve</span><br><span class="line"><span class="keyword">from</span> utils.torch_utils <span class="keyword">import</span> (EarlyStopping, ModelEMA, de_parallel, select_device, smart_DDP, smart_optimizer,</span><br><span class="line">                               smart_resume, torch_distributed_zero_first)</span><br><span class="line"></span><br><span class="line">LOCAL_RANK = <span class="built_in">int</span>(os.getenv(<span class="string">&#x27;LOCAL_RANK&#x27;</span>, -<span class="number">1</span>))  <span class="comment"># https://pytorch.org/docs/stable/elastic/run.html</span></span><br><span class="line">RANK = <span class="built_in">int</span>(os.getenv(<span class="string">&#x27;RANK&#x27;</span>, -<span class="number">1</span>))</span><br><span class="line">WORLD_SIZE = <span class="built_in">int</span>(os.getenv(<span class="string">&#x27;WORLD_SIZE&#x27;</span>, <span class="number">1</span>))</span><br><span class="line">GIT_INFO = check_git_info()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">train</span>(<span class="params">hyp, opt, device, callbacks</span>):  <span class="comment"># hyp is path/to/hyp.yaml or hyp dictionary</span></span><br><span class="line">    save_dir, epochs, batch_size, weights, single_cls, evolve, data, cfg, resume, noval, nosave, workers, freeze = \</span><br><span class="line">        Path(opt.save_dir), opt.epochs, opt.batch_size, opt.weights, opt.single_cls, opt.evolve, opt.data, opt.cfg, \</span><br><span class="line">        opt.resume, opt.noval, opt.nosave, opt.workers, opt.freeze</span><br><span class="line">    callbacks.run(<span class="string">&#x27;on_pretrain_routine_start&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Directories</span></span><br><span class="line">    w = save_dir / <span class="string">&#x27;weights&#x27;</span>  <span class="comment"># weights dir</span></span><br><span class="line">    (w.parent <span class="keyword">if</span> evolve <span class="keyword">else</span> w).mkdir(parents=<span class="literal">True</span>, exist_ok=<span class="literal">True</span>)  <span class="comment"># make dir</span></span><br><span class="line">    last, best = w / <span class="string">&#x27;last.pt&#x27;</span>, w / <span class="string">&#x27;best.pt&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Hyperparameters</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(hyp, <span class="built_in">str</span>):</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(hyp, errors=<span class="string">&#x27;ignore&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            hyp = yaml.safe_load(f)  <span class="comment"># load hyps dict</span></span><br><span class="line">    LOGGER.info(colorstr(<span class="string">&#x27;hyperparameters: &#x27;</span>) + <span class="string">&#x27;, &#x27;</span>.join(<span class="string">f&#x27;<span class="subst">&#123;k&#125;</span>=<span class="subst">&#123;v&#125;</span>&#x27;</span> <span class="keyword">for</span> k, v <span class="keyword">in</span> hyp.items()))</span><br><span class="line">    opt.hyp = hyp.copy()  <span class="comment"># for saving hyps to checkpoints</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Save run settings</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> evolve:</span><br><span class="line">        yaml_save(save_dir / <span class="string">&#x27;hyp.yaml&#x27;</span>, hyp)</span><br><span class="line">        yaml_save(save_dir / <span class="string">&#x27;opt.yaml&#x27;</span>, <span class="built_in">vars</span>(opt))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Loggers</span></span><br><span class="line">    data_dict = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">if</span> RANK <span class="keyword">in</span> &#123;-<span class="number">1</span>, <span class="number">0</span>&#125;:</span><br><span class="line">        loggers = Loggers(save_dir, weights, opt, hyp, LOGGER)  <span class="comment"># loggers instance</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Register actions</span></span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> methods(loggers):</span><br><span class="line">            callbacks.register_action(k, callback=<span class="built_in">getattr</span>(loggers, k))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Process custom dataset artifact link</span></span><br><span class="line">        data_dict = loggers.remote_dataset</span><br><span class="line">        <span class="keyword">if</span> resume:  <span class="comment"># If resuming runs from remote artifact</span></span><br><span class="line">            weights, epochs, hyp, batch_size = opt.weights, opt.epochs, opt.hyp, opt.batch_size</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Config</span></span><br><span class="line">    plots = <span class="keyword">not</span> evolve <span class="keyword">and</span> <span class="keyword">not</span> opt.noplots  <span class="comment"># create plots</span></span><br><span class="line">    cuda = device.<span class="built_in">type</span> != <span class="string">&#x27;cpu&#x27;</span></span><br><span class="line">    init_seeds(opt.seed + <span class="number">1</span> + RANK, deterministic=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">with</span> torch_distributed_zero_first(LOCAL_RANK):</span><br><span class="line">        data_dict = data_dict <span class="keyword">or</span> check_dataset(data)  <span class="comment"># check if None</span></span><br><span class="line">    train_path, val_path = data_dict[<span class="string">&#x27;train&#x27;</span>], data_dict[<span class="string">&#x27;val&#x27;</span>]</span><br><span class="line">    nc = <span class="number">1</span> <span class="keyword">if</span> single_cls <span class="keyword">else</span> <span class="built_in">int</span>(data_dict[<span class="string">&#x27;nc&#x27;</span>])  <span class="comment"># number of classes</span></span><br><span class="line">    names = &#123;<span class="number">0</span>: <span class="string">&#x27;item&#x27;</span>&#125; <span class="keyword">if</span> single_cls <span class="keyword">and</span> <span class="built_in">len</span>(data_dict[<span class="string">&#x27;names&#x27;</span>]) != <span class="number">1</span> <span class="keyword">else</span> data_dict[<span class="string">&#x27;names&#x27;</span>]  <span class="comment"># class names</span></span><br><span class="line">    is_coco = <span class="built_in">isinstance</span>(val_path, <span class="built_in">str</span>) <span class="keyword">and</span> val_path.endswith(<span class="string">&#x27;coco/val2017.txt&#x27;</span>)  <span class="comment"># COCO dataset</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Model</span></span><br><span class="line">    check_suffix(weights, <span class="string">&#x27;.pt&#x27;</span>)  <span class="comment"># check weights</span></span><br><span class="line">    pretrained = weights.endswith(<span class="string">&#x27;.pt&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> pretrained:</span><br><span class="line">        <span class="keyword">with</span> torch_distributed_zero_first(LOCAL_RANK):</span><br><span class="line">            weights = attempt_download(weights)  <span class="comment"># download if not found locally</span></span><br><span class="line">        ckpt = torch.load(weights, map_location=<span class="string">&#x27;cpu&#x27;</span>)  <span class="comment"># load checkpoint to CPU to avoid CUDA memory leak</span></span><br><span class="line">        model = Model(cfg <span class="keyword">or</span> ckpt[<span class="string">&#x27;model&#x27;</span>].yaml, ch=<span class="number">3</span>, nc=nc, anchors=hyp.get(<span class="string">&#x27;anchors&#x27;</span>)).to(device)  <span class="comment"># create</span></span><br><span class="line">        exclude = [<span class="string">&#x27;anchor&#x27;</span>] <span class="keyword">if</span> (cfg <span class="keyword">or</span> hyp.get(<span class="string">&#x27;anchors&#x27;</span>)) <span class="keyword">and</span> <span class="keyword">not</span> resume <span class="keyword">else</span> []  <span class="comment"># exclude keys</span></span><br><span class="line">        csd = ckpt[<span class="string">&#x27;model&#x27;</span>].<span class="built_in">float</span>().state_dict()  <span class="comment"># checkpoint state_dict as FP32</span></span><br><span class="line">        csd = intersect_dicts(csd, model.state_dict(), exclude=exclude)  <span class="comment"># intersect</span></span><br><span class="line">        model.load_state_dict(csd, strict=<span class="literal">False</span>)  <span class="comment"># load</span></span><br><span class="line">        LOGGER.info(<span class="string">f&#x27;Transferred <span class="subst">&#123;<span class="built_in">len</span>(csd)&#125;</span>/<span class="subst">&#123;<span class="built_in">len</span>(model.state_dict())&#125;</span> items from <span class="subst">&#123;weights&#125;</span>&#x27;</span>)  <span class="comment"># report</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        model = Model(cfg, ch=<span class="number">3</span>, nc=nc, anchors=hyp.get(<span class="string">&#x27;anchors&#x27;</span>)).to(device)  <span class="comment"># create</span></span><br><span class="line">    amp = check_amp(model)  <span class="comment"># check AMP</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Freeze</span></span><br><span class="line">    freeze = [<span class="string">f&#x27;model.<span class="subst">&#123;x&#125;</span>.&#x27;</span> <span class="keyword">for</span> x <span class="keyword">in</span> (freeze <span class="keyword">if</span> <span class="built_in">len</span>(freeze) &gt; <span class="number">1</span> <span class="keyword">else</span> <span class="built_in">range</span>(freeze[<span class="number">0</span>]))]  <span class="comment"># layers to freeze</span></span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> model.named_parameters():</span><br><span class="line">        v.requires_grad = <span class="literal">True</span>  <span class="comment"># train all layers</span></span><br><span class="line">        <span class="comment"># v.register_hook(lambda x: torch.nan_to_num(x))  # NaN to 0 (commented for erratic training results)</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">any</span>(x <span class="keyword">in</span> k <span class="keyword">for</span> x <span class="keyword">in</span> freeze):</span><br><span class="line">            LOGGER.info(<span class="string">f&#x27;freezing <span class="subst">&#123;k&#125;</span>&#x27;</span>)</span><br><span class="line">            v.requires_grad = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Image size</span></span><br><span class="line">    gs = <span class="built_in">max</span>(<span class="built_in">int</span>(model.stride.<span class="built_in">max</span>()), <span class="number">32</span>)  <span class="comment"># grid size (max stride)</span></span><br><span class="line">    imgsz = check_img_size(opt.imgsz, gs, floor=gs * <span class="number">2</span>)  <span class="comment"># verify imgsz is gs-multiple</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Batch size</span></span><br><span class="line">    <span class="keyword">if</span> RANK == -<span class="number">1</span> <span class="keyword">and</span> batch_size == -<span class="number">1</span>:  <span class="comment"># single-GPU only, estimate best batch size</span></span><br><span class="line">        batch_size = check_train_batch_size(model, imgsz, amp)</span><br><span class="line">        loggers.on_params_update(&#123;<span class="string">&quot;batch_size&quot;</span>: batch_size&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Optimizer</span></span><br><span class="line">    nbs = <span class="number">64</span>  <span class="comment"># nominal batch size</span></span><br><span class="line">    accumulate = <span class="built_in">max</span>(<span class="built_in">round</span>(nbs / batch_size), <span class="number">1</span>)  <span class="comment"># accumulate loss before optimizing</span></span><br><span class="line">    hyp[<span class="string">&#x27;weight_decay&#x27;</span>] *= batch_size * accumulate / nbs  <span class="comment"># scale weight_decay</span></span><br><span class="line">    optimizer = smart_optimizer(model, opt.optimizer, hyp[<span class="string">&#x27;lr0&#x27;</span>], hyp[<span class="string">&#x27;momentum&#x27;</span>], hyp[<span class="string">&#x27;weight_decay&#x27;</span>])</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Scheduler</span></span><br><span class="line">    <span class="keyword">if</span> opt.cos_lr:</span><br><span class="line">        lf = one_cycle(<span class="number">1</span>, hyp[<span class="string">&#x27;lrf&#x27;</span>], epochs)  <span class="comment"># cosine 1-&gt;hyp[&#x27;lrf&#x27;]</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        lf = <span class="keyword">lambda</span> x: (<span class="number">1</span> - x / epochs) * (<span class="number">1.0</span> - hyp[<span class="string">&#x27;lrf&#x27;</span>]) + hyp[<span class="string">&#x27;lrf&#x27;</span>]  <span class="comment"># linear</span></span><br><span class="line">    scheduler = lr_scheduler.LambdaLR(optimizer, lr_lambda=lf)  <span class="comment"># plot_lr_scheduler(optimizer, scheduler, epochs)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># EMA</span></span><br><span class="line">    ema = ModelEMA(model) <span class="keyword">if</span> RANK <span class="keyword">in</span> &#123;-<span class="number">1</span>, <span class="number">0</span>&#125; <span class="keyword">else</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Resume</span></span><br><span class="line">    best_fitness, start_epoch = <span class="number">0.0</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">if</span> pretrained:</span><br><span class="line">        <span class="keyword">if</span> resume:</span><br><span class="line">            best_fitness, start_epoch, epochs = smart_resume(ckpt, optimizer, ema, weights, epochs, resume)</span><br><span class="line">        <span class="keyword">del</span> ckpt, csd</span><br><span class="line"></span><br><span class="line">    <span class="comment"># DP mode</span></span><br><span class="line">    <span class="keyword">if</span> cuda <span class="keyword">and</span> RANK == -<span class="number">1</span> <span class="keyword">and</span> torch.cuda.device_count() &gt; <span class="number">1</span>:</span><br><span class="line">        LOGGER.warning(<span class="string">&#x27;WARNING âš ï¸ DP not recommended, use torch.distributed.run for best DDP Multi-GPU results.\n&#x27;</span></span><br><span class="line">                       <span class="string">&#x27;See Multi-GPU Tutorial at https://github.com/ultralytics/yolov5/issues/475 to get started.&#x27;</span>)</span><br><span class="line">        model = torch.nn.DataParallel(model)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># SyncBatchNorm</span></span><br><span class="line">    <span class="keyword">if</span> opt.sync_bn <span class="keyword">and</span> cuda <span class="keyword">and</span> RANK != -<span class="number">1</span>:</span><br><span class="line">        model = torch.nn.SyncBatchNorm.convert_sync_batchnorm(model).to(device)</span><br><span class="line">        LOGGER.info(<span class="string">&#x27;Using SyncBatchNorm()&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Trainloader</span></span><br><span class="line">    train_loader, dataset = create_dataloader(train_path,</span><br><span class="line">                                              imgsz,</span><br><span class="line">                                              batch_size // WORLD_SIZE,</span><br><span class="line">                                              gs,</span><br><span class="line">                                              single_cls,</span><br><span class="line">                                              hyp=hyp,</span><br><span class="line">                                              augment=<span class="literal">True</span>,</span><br><span class="line">                                              cache=<span class="literal">None</span> <span class="keyword">if</span> opt.cache == <span class="string">&#x27;val&#x27;</span> <span class="keyword">else</span> opt.cache,</span><br><span class="line">                                              rect=opt.rect,</span><br><span class="line">                                              rank=LOCAL_RANK,</span><br><span class="line">                                              workers=workers,</span><br><span class="line">                                              image_weights=opt.image_weights,</span><br><span class="line">                                              quad=opt.quad,</span><br><span class="line">                                              prefix=colorstr(<span class="string">&#x27;train: &#x27;</span>),</span><br><span class="line">                                              shuffle=<span class="literal">True</span>)</span><br><span class="line">    labels = np.concatenate(dataset.labels, <span class="number">0</span>)</span><br><span class="line">    mlc = <span class="built_in">int</span>(labels[:, <span class="number">0</span>].<span class="built_in">max</span>())  <span class="comment"># max label class</span></span><br><span class="line">    <span class="keyword">assert</span> mlc &lt; nc, <span class="string">f&#x27;Label class <span class="subst">&#123;mlc&#125;</span> exceeds nc=<span class="subst">&#123;nc&#125;</span> in <span class="subst">&#123;data&#125;</span>. Possible class labels are 0-<span class="subst">&#123;nc - <span class="number">1</span>&#125;</span>&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Process 0</span></span><br><span class="line">    <span class="keyword">if</span> RANK <span class="keyword">in</span> &#123;-<span class="number">1</span>, <span class="number">0</span>&#125;:</span><br><span class="line">        val_loader = create_dataloader(val_path,</span><br><span class="line">                                       imgsz,</span><br><span class="line">                                       batch_size // WORLD_SIZE * <span class="number">2</span>,</span><br><span class="line">                                       gs,</span><br><span class="line">                                       single_cls,</span><br><span class="line">                                       hyp=hyp,</span><br><span class="line">                                       cache=<span class="literal">None</span> <span class="keyword">if</span> noval <span class="keyword">else</span> opt.cache,</span><br><span class="line">                                       rect=<span class="literal">True</span>,</span><br><span class="line">                                       rank=-<span class="number">1</span>,</span><br><span class="line">                                       workers=workers * <span class="number">2</span>,</span><br><span class="line">                                       pad=<span class="number">0.5</span>,</span><br><span class="line">                                       prefix=colorstr(<span class="string">&#x27;val: &#x27;</span>))[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> resume:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> opt.noautoanchor:</span><br><span class="line">                check_anchors(dataset, model=model, thr=hyp[<span class="string">&#x27;anchor_t&#x27;</span>], imgsz=imgsz)  <span class="comment"># run AutoAnchor</span></span><br><span class="line">            model.half().<span class="built_in">float</span>()  <span class="comment"># pre-reduce anchor precision</span></span><br><span class="line"></span><br><span class="line">        callbacks.run(<span class="string">&#x27;on_pretrain_routine_end&#x27;</span>, labels, names)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># DDP mode</span></span><br><span class="line">    <span class="keyword">if</span> cuda <span class="keyword">and</span> RANK != -<span class="number">1</span>:</span><br><span class="line">        model = smart_DDP(model)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Model attributes</span></span><br><span class="line">    nl = de_parallel(model).model[-<span class="number">1</span>].nl  <span class="comment"># number of detection layers (to scale hyps)</span></span><br><span class="line">    hyp[<span class="string">&#x27;box&#x27;</span>] *= <span class="number">3</span> / nl  <span class="comment"># scale to layers</span></span><br><span class="line">    hyp[<span class="string">&#x27;cls&#x27;</span>] *= nc / <span class="number">80</span> * <span class="number">3</span> / nl  <span class="comment"># scale to classes and layers</span></span><br><span class="line">    hyp[<span class="string">&#x27;obj&#x27;</span>] *= (imgsz / <span class="number">640</span>) ** <span class="number">2</span> * <span class="number">3</span> / nl  <span class="comment"># scale to image size and layers</span></span><br><span class="line">    hyp[<span class="string">&#x27;label_smoothing&#x27;</span>] = opt.label_smoothing</span><br><span class="line">    model.nc = nc  <span class="comment"># attach number of classes to model</span></span><br><span class="line">    model.hyp = hyp  <span class="comment"># attach hyperparameters to model</span></span><br><span class="line">    model.class_weights = labels_to_class_weights(dataset.labels, nc).to(device) * nc  <span class="comment"># attach class weights</span></span><br><span class="line">    model.names = names</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Start training</span></span><br><span class="line">    t0 = time.time()</span><br><span class="line">    nb = <span class="built_in">len</span>(train_loader)  <span class="comment"># number of batches</span></span><br><span class="line">    nw = <span class="built_in">max</span>(<span class="built_in">round</span>(hyp[<span class="string">&#x27;warmup_epochs&#x27;</span>] * nb), <span class="number">100</span>)  <span class="comment"># number of warmup iterations, max(3 epochs, 100 iterations)</span></span><br><span class="line">    <span class="comment"># nw = min(nw, (epochs - start_epoch) / 2 * nb)  # limit warmup to &lt; 1/2 of training</span></span><br><span class="line">    last_opt_step = -<span class="number">1</span></span><br><span class="line">    maps = np.zeros(nc)  <span class="comment"># mAP per class</span></span><br><span class="line">    results = (<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)  <span class="comment"># P, R, mAP@.5, mAP@.5-.95, val_loss(box, obj, cls)</span></span><br><span class="line">    scheduler.last_epoch = start_epoch - <span class="number">1</span>  <span class="comment"># do not move</span></span><br><span class="line">    scaler = torch.cuda.amp.GradScaler(enabled=amp)</span><br><span class="line">    stopper, stop = EarlyStopping(patience=opt.patience), <span class="literal">False</span></span><br><span class="line">    compute_loss = ComputeLoss(model)  <span class="comment"># init loss class</span></span><br><span class="line">    callbacks.run(<span class="string">&#x27;on_train_start&#x27;</span>)</span><br><span class="line">    LOGGER.info(<span class="string">f&#x27;Image sizes <span class="subst">&#123;imgsz&#125;</span> train, <span class="subst">&#123;imgsz&#125;</span> val\n&#x27;</span></span><br><span class="line">                <span class="string">f&#x27;Using <span class="subst">&#123;train_loader.num_workers * WORLD_SIZE&#125;</span> dataloader workers\n&#x27;</span></span><br><span class="line">                <span class="string">f&quot;Logging results to <span class="subst">&#123;colorstr(<span class="string">&#x27;bold&#x27;</span>, save_dir)&#125;</span>\n&quot;</span></span><br><span class="line">                <span class="string">f&#x27;Starting training for <span class="subst">&#123;epochs&#125;</span> epochs...&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="built_in">range</span>(start_epoch, epochs):  <span class="comment"># epoch ------------------------------------------------------------------</span></span><br><span class="line">        callbacks.run(<span class="string">&#x27;on_train_epoch_start&#x27;</span>)</span><br><span class="line">        model.train()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Update image weights (optional, single-GPU only)</span></span><br><span class="line">        <span class="keyword">if</span> opt.image_weights:</span><br><span class="line">            cw = model.class_weights.cpu().numpy() * (<span class="number">1</span> - maps) ** <span class="number">2</span> / nc  <span class="comment"># class weights</span></span><br><span class="line">            iw = labels_to_image_weights(dataset.labels, nc=nc, class_weights=cw)  <span class="comment"># image weights</span></span><br><span class="line">            dataset.indices = random.choices(<span class="built_in">range</span>(dataset.n), weights=iw, k=dataset.n)  <span class="comment"># rand weighted idx</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Update mosaic border (optional)</span></span><br><span class="line">        <span class="comment"># b = int(random.uniform(0.25 * imgsz, 0.75 * imgsz + gs) // gs * gs)</span></span><br><span class="line">        <span class="comment"># dataset.mosaic_border = [b - imgsz, -b]  # height, width borders</span></span><br><span class="line"></span><br><span class="line">        mloss = torch.zeros(<span class="number">3</span>, device=device)  <span class="comment"># mean losses</span></span><br><span class="line">        <span class="keyword">if</span> RANK != -<span class="number">1</span>:</span><br><span class="line">            train_loader.sampler.set_epoch(epoch)</span><br><span class="line">        pbar = <span class="built_in">enumerate</span>(train_loader)</span><br><span class="line">        LOGGER.info((<span class="string">&#x27;\n&#x27;</span> + <span class="string">&#x27;%11s&#x27;</span> * <span class="number">7</span>) % (<span class="string">&#x27;Epoch&#x27;</span>, <span class="string">&#x27;GPU_mem&#x27;</span>, <span class="string">&#x27;box_loss&#x27;</span>, <span class="string">&#x27;obj_loss&#x27;</span>, <span class="string">&#x27;cls_loss&#x27;</span>, <span class="string">&#x27;Instances&#x27;</span>, <span class="string">&#x27;Size&#x27;</span>))</span><br><span class="line">        <span class="keyword">if</span> RANK <span class="keyword">in</span> &#123;-<span class="number">1</span>, <span class="number">0</span>&#125;:</span><br><span class="line">            pbar = tqdm(pbar, total=nb, bar_format=TQDM_BAR_FORMAT)  <span class="comment"># progress bar</span></span><br><span class="line">        optimizer.zero_grad()</span><br><span class="line">        <span class="keyword">for</span> i, (imgs, targets, paths, _) <span class="keyword">in</span> pbar:  <span class="comment"># batch -------------------------------------------------------------</span></span><br><span class="line">            callbacks.run(<span class="string">&#x27;on_train_batch_start&#x27;</span>)</span><br><span class="line">            ni = i + nb * epoch  <span class="comment"># number integrated batches (since train start)</span></span><br><span class="line">            imgs = imgs.to(device, non_blocking=<span class="literal">True</span>).<span class="built_in">float</span>() / <span class="number">255</span>  <span class="comment"># uint8 to float32, 0-255 to 0.0-1.0</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># Warmup</span></span><br><span class="line">            <span class="keyword">if</span> ni &lt;= nw:</span><br><span class="line">                xi = [<span class="number">0</span>, nw]  <span class="comment"># x interp</span></span><br><span class="line">                <span class="comment"># compute_loss.gr = np.interp(ni, xi, [0.0, 1.0])  # iou loss ratio (obj_loss = 1.0 or iou)</span></span><br><span class="line">                accumulate = <span class="built_in">max</span>(<span class="number">1</span>, np.interp(ni, xi, [<span class="number">1</span>, nbs / batch_size]).<span class="built_in">round</span>())</span><br><span class="line">                <span class="keyword">for</span> j, x <span class="keyword">in</span> <span class="built_in">enumerate</span>(optimizer.param_groups):</span><br><span class="line">                    <span class="comment"># bias lr falls from 0.1 to lr0, all other lrs rise from 0.0 to lr0</span></span><br><span class="line">                    x[<span class="string">&#x27;lr&#x27;</span>] = np.interp(ni, xi, [hyp[<span class="string">&#x27;warmup_bias_lr&#x27;</span>] <span class="keyword">if</span> j == <span class="number">0</span> <span class="keyword">else</span> <span class="number">0.0</span>, x[<span class="string">&#x27;initial_lr&#x27;</span>] * lf(epoch)])</span><br><span class="line">                    <span class="keyword">if</span> <span class="string">&#x27;momentum&#x27;</span> <span class="keyword">in</span> x:</span><br><span class="line">                        x[<span class="string">&#x27;momentum&#x27;</span>] = np.interp(ni, xi, [hyp[<span class="string">&#x27;warmup_momentum&#x27;</span>], hyp[<span class="string">&#x27;momentum&#x27;</span>]])</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Multi-scale</span></span><br><span class="line">            <span class="keyword">if</span> opt.multi_scale:</span><br><span class="line">                sz = random.randrange(imgsz * <span class="number">0.5</span>, imgsz * <span class="number">1.5</span> + gs) // gs * gs  <span class="comment"># size</span></span><br><span class="line">                sf = sz / <span class="built_in">max</span>(imgs.shape[<span class="number">2</span>:])  <span class="comment"># scale factor</span></span><br><span class="line">                <span class="keyword">if</span> sf != <span class="number">1</span>:</span><br><span class="line">                    ns = [math.ceil(x * sf / gs) * gs <span class="keyword">for</span> x <span class="keyword">in</span> imgs.shape[<span class="number">2</span>:]]  <span class="comment"># new shape (stretched to gs-multiple)</span></span><br><span class="line">                    imgs = nn.functional.interpolate(imgs, size=ns, mode=<span class="string">&#x27;bilinear&#x27;</span>, align_corners=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Forward</span></span><br><span class="line">            <span class="keyword">with</span> torch.cuda.amp.autocast(amp):</span><br><span class="line">                pred = model(imgs)  <span class="comment"># forward</span></span><br><span class="line">                loss, loss_items = compute_loss(pred, targets.to(device))  <span class="comment"># loss scaled by batch_size</span></span><br><span class="line">                <span class="keyword">if</span> RANK != -<span class="number">1</span>:</span><br><span class="line">                    loss *= WORLD_SIZE  <span class="comment"># gradient averaged between devices in DDP mode</span></span><br><span class="line">                <span class="keyword">if</span> opt.quad:</span><br><span class="line">                    loss *= <span class="number">4.</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># Backward</span></span><br><span class="line">            scaler.scale(loss).backward()</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Optimize - https://pytorch.org/docs/master/notes/amp_examples.html</span></span><br><span class="line">            <span class="keyword">if</span> ni - last_opt_step &gt;= accumulate:</span><br><span class="line">                scaler.unscale_(optimizer)  <span class="comment"># unscale gradients</span></span><br><span class="line">                torch.nn.utils.clip_grad_norm_(model.parameters(), max_norm=<span class="number">10.0</span>)  <span class="comment"># clip gradients</span></span><br><span class="line">                scaler.step(optimizer)  <span class="comment"># optimizer.step</span></span><br><span class="line">                scaler.update()</span><br><span class="line">                optimizer.zero_grad()</span><br><span class="line">                <span class="keyword">if</span> ema:</span><br><span class="line">                    ema.update(model)</span><br><span class="line">                last_opt_step = ni</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Log</span></span><br><span class="line">            <span class="keyword">if</span> RANK <span class="keyword">in</span> &#123;-<span class="number">1</span>, <span class="number">0</span>&#125;:</span><br><span class="line">                mloss = (mloss * i + loss_items) / (i + <span class="number">1</span>)  <span class="comment"># update mean losses</span></span><br><span class="line">                mem = <span class="string">f&#x27;<span class="subst">&#123;torch.cuda.memory_reserved() / <span class="number">1E9</span> <span class="keyword">if</span> torch.cuda.is_available() <span class="keyword">else</span> <span class="number">0</span>:<span class="number">.3</span>g&#125;</span>G&#x27;</span>  <span class="comment"># (GB)</span></span><br><span class="line">                pbar.set_description((<span class="string">&#x27;%11s&#x27;</span> * <span class="number">2</span> + <span class="string">&#x27;%11.4g&#x27;</span> * <span class="number">5</span>) %</span><br><span class="line">                                     (<span class="string">f&#x27;<span class="subst">&#123;epoch&#125;</span>/<span class="subst">&#123;epochs - <span class="number">1</span>&#125;</span>&#x27;</span>, mem, *mloss, targets.shape[<span class="number">0</span>], imgs.shape[-<span class="number">1</span>]))</span><br><span class="line">                callbacks.run(<span class="string">&#x27;on_train_batch_end&#x27;</span>, model, ni, imgs, targets, paths, <span class="built_in">list</span>(mloss))</span><br><span class="line">                <span class="keyword">if</span> callbacks.stop_training:</span><br><span class="line">                    <span class="keyword">return</span></span><br><span class="line">            <span class="comment"># end batch ------------------------------------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Scheduler</span></span><br><span class="line">        lr = [x[<span class="string">&#x27;lr&#x27;</span>] <span class="keyword">for</span> x <span class="keyword">in</span> optimizer.param_groups]  <span class="comment"># for loggers</span></span><br><span class="line">        scheduler.step()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> RANK <span class="keyword">in</span> &#123;-<span class="number">1</span>, <span class="number">0</span>&#125;:</span><br><span class="line">            <span class="comment"># mAP</span></span><br><span class="line">            callbacks.run(<span class="string">&#x27;on_train_epoch_end&#x27;</span>, epoch=epoch)</span><br><span class="line">            ema.update_attr(model, include=[<span class="string">&#x27;yaml&#x27;</span>, <span class="string">&#x27;nc&#x27;</span>, <span class="string">&#x27;hyp&#x27;</span>, <span class="string">&#x27;names&#x27;</span>, <span class="string">&#x27;stride&#x27;</span>, <span class="string">&#x27;class_weights&#x27;</span>])</span><br><span class="line">            final_epoch = (epoch + <span class="number">1</span> == epochs) <span class="keyword">or</span> stopper.possible_stop</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> noval <span class="keyword">or</span> final_epoch:  <span class="comment"># Calculate mAP</span></span><br><span class="line">                results, maps, _ = validate.run(data_dict,</span><br><span class="line">                                                batch_size=batch_size // WORLD_SIZE * <span class="number">2</span>,</span><br><span class="line">                                                imgsz=imgsz,</span><br><span class="line">                                                half=amp,</span><br><span class="line">                                                model=ema.ema,</span><br><span class="line">                                                single_cls=single_cls,</span><br><span class="line">                                                dataloader=val_loader,</span><br><span class="line">                                                save_dir=save_dir,</span><br><span class="line">                                                plots=<span class="literal">False</span>,</span><br><span class="line">                                                callbacks=callbacks,</span><br><span class="line">                                                compute_loss=compute_loss)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Update best mAP</span></span><br><span class="line">            fi = fitness(np.array(results).reshape(<span class="number">1</span>, -<span class="number">1</span>))  <span class="comment"># weighted combination of [P, R, mAP@.5, mAP@.5-.95]</span></span><br><span class="line">            stop = stopper(epoch=epoch, fitness=fi)  <span class="comment"># early stop check</span></span><br><span class="line">            <span class="keyword">if</span> fi &gt; best_fitness:</span><br><span class="line">                best_fitness = fi</span><br><span class="line">            log_vals = <span class="built_in">list</span>(mloss) + <span class="built_in">list</span>(results) + lr</span><br><span class="line">            callbacks.run(<span class="string">&#x27;on_fit_epoch_end&#x27;</span>, log_vals, epoch, best_fitness, fi)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Save model</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">not</span> nosave) <span class="keyword">or</span> (final_epoch <span class="keyword">and</span> <span class="keyword">not</span> evolve):  <span class="comment"># if save</span></span><br><span class="line">                ckpt = &#123;</span><br><span class="line">                    <span class="string">&#x27;epoch&#x27;</span>: epoch,</span><br><span class="line">                    <span class="string">&#x27;best_fitness&#x27;</span>: best_fitness,</span><br><span class="line">                    <span class="string">&#x27;model&#x27;</span>: deepcopy(de_parallel(model)).half(),</span><br><span class="line">                    <span class="string">&#x27;ema&#x27;</span>: deepcopy(ema.ema).half(),</span><br><span class="line">                    <span class="string">&#x27;updates&#x27;</span>: ema.updates,</span><br><span class="line">                    <span class="string">&#x27;optimizer&#x27;</span>: optimizer.state_dict(),</span><br><span class="line">                    <span class="string">&#x27;opt&#x27;</span>: <span class="built_in">vars</span>(opt),</span><br><span class="line">                    <span class="string">&#x27;git&#x27;</span>: GIT_INFO,  <span class="comment"># &#123;remote, branch, commit&#125; if a git repo</span></span><br><span class="line">                    <span class="string">&#x27;date&#x27;</span>: datetime.now().isoformat()&#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment"># Save last, best and delete</span></span><br><span class="line">                torch.save(ckpt, last)</span><br><span class="line">                <span class="keyword">if</span> best_fitness == fi:</span><br><span class="line">                    torch.save(ckpt, best)</span><br><span class="line">                <span class="keyword">if</span> opt.save_period &gt; <span class="number">0</span> <span class="keyword">and</span> epoch % opt.save_period == <span class="number">0</span>:</span><br><span class="line">                    torch.save(ckpt, w / <span class="string">f&#x27;epoch<span class="subst">&#123;epoch&#125;</span>.pt&#x27;</span>)</span><br><span class="line">                <span class="keyword">del</span> ckpt</span><br><span class="line">                callbacks.run(<span class="string">&#x27;on_model_save&#x27;</span>, last, epoch, final_epoch, best_fitness, fi)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># EarlyStopping</span></span><br><span class="line">        <span class="keyword">if</span> RANK != -<span class="number">1</span>:  <span class="comment"># if DDP training</span></span><br><span class="line">            broadcast_list = [stop <span class="keyword">if</span> RANK == <span class="number">0</span> <span class="keyword">else</span> <span class="literal">None</span>]</span><br><span class="line">            dist.broadcast_object_list(broadcast_list, <span class="number">0</span>)  <span class="comment"># broadcast &#x27;stop&#x27; to all ranks</span></span><br><span class="line">            <span class="keyword">if</span> RANK != <span class="number">0</span>:</span><br><span class="line">                stop = broadcast_list[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">if</span> stop:</span><br><span class="line">            <span class="keyword">break</span>  <span class="comment"># must break all DDP ranks</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># end epoch ----------------------------------------------------------------------------------------------------</span></span><br><span class="line">    <span class="comment"># end training -----------------------------------------------------------------------------------------------------</span></span><br><span class="line">    <span class="keyword">if</span> RANK <span class="keyword">in</span> &#123;-<span class="number">1</span>, <span class="number">0</span>&#125;:</span><br><span class="line">        LOGGER.info(<span class="string">f&#x27;\n<span class="subst">&#123;epoch - start_epoch + <span class="number">1</span>&#125;</span> epochs completed in <span class="subst">&#123;(time.time() - t0) / <span class="number">3600</span>:<span class="number">.3</span>f&#125;</span> hours.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> f <span class="keyword">in</span> last, best:</span><br><span class="line">            <span class="keyword">if</span> f.exists():</span><br><span class="line">                strip_optimizer(f)  <span class="comment"># strip optimizers</span></span><br><span class="line">                <span class="keyword">if</span> f <span class="keyword">is</span> best:</span><br><span class="line">                    LOGGER.info(<span class="string">f&#x27;\nValidating <span class="subst">&#123;f&#125;</span>...&#x27;</span>)</span><br><span class="line">                    results, _, _ = validate.run(</span><br><span class="line">                        data_dict,</span><br><span class="line">                        batch_size=batch_size // WORLD_SIZE * <span class="number">2</span>,</span><br><span class="line">                        imgsz=imgsz,</span><br><span class="line">                        model=attempt_load(f, device).half(),</span><br><span class="line">                        iou_thres=<span class="number">0.65</span> <span class="keyword">if</span> is_coco <span class="keyword">else</span> <span class="number">0.60</span>,  <span class="comment"># best pycocotools at iou 0.65</span></span><br><span class="line">                        single_cls=single_cls,</span><br><span class="line">                        dataloader=val_loader,</span><br><span class="line">                        save_dir=save_dir,</span><br><span class="line">                        save_json=is_coco,</span><br><span class="line">                        verbose=<span class="literal">True</span>,</span><br><span class="line">                        plots=plots,</span><br><span class="line">                        callbacks=callbacks,</span><br><span class="line">                        compute_loss=compute_loss)  <span class="comment"># val best model with plots</span></span><br><span class="line">                    <span class="keyword">if</span> is_coco:</span><br><span class="line">                        callbacks.run(<span class="string">&#x27;on_fit_epoch_end&#x27;</span>, <span class="built_in">list</span>(mloss) + <span class="built_in">list</span>(results) + lr, epoch, best_fitness, fi)</span><br><span class="line"></span><br><span class="line">        callbacks.run(<span class="string">&#x27;on_train_end&#x27;</span>, last, best, epoch, results)</span><br><span class="line"></span><br><span class="line">    torch.cuda.empty_cache()</span><br><span class="line">    <span class="keyword">return</span> results</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">parse_opt</span>(<span class="params">known=<span class="literal">False</span></span>):</span><br><span class="line">    parser = argparse.ArgumentParser()</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--weights&#x27;</span>, <span class="built_in">type</span>=<span class="built_in">str</span>, default=ROOT / <span class="string">&#x27;yolov5s.pt&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;åˆå§‹ weights è·¯å¾‘&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--cfg&#x27;</span>, <span class="built_in">type</span>=<span class="built_in">str</span>, default=<span class="string">&#x27;&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;model.yaml è·¯å¾‘&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--data&#x27;</span>, <span class="built_in">type</span>=<span class="built_in">str</span>, default=ROOT / <span class="string">&#x27;data/coco128.yaml&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;dataset.yaml è·¯å¾‘&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--hyp&#x27;</span>, <span class="built_in">type</span>=<span class="built_in">str</span>, default=ROOT / <span class="string">&#x27;data/hyps/hyp.scratch-low.yaml&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;hyperparameters è·¯å¾‘&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--epochs&#x27;</span>, <span class="built_in">type</span>=<span class="built_in">int</span>, default=<span class="number">100</span>, <span class="built_in">help</span>=<span class="string">&#x27;ç¸½è¨“ç·´æ™‚æœŸ&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--batch-size&#x27;</span>, <span class="built_in">type</span>=<span class="built_in">int</span>, default=<span class="number">16</span>, <span class="built_in">help</span>=<span class="string">&#x27;æ‰€æœ‰ GPU çš„ç¸½æ‰¹æ¬¡å¤§å°ï¼Œ-1 è¡¨ç¤ºè‡ªå‹•æ‰¹æ¬¡&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--imgsz&#x27;</span>, <span class="string">&#x27;--img&#x27;</span>, <span class="string">&#x27;--img-size&#x27;</span>, <span class="built_in">type</span>=<span class="built_in">int</span>, default=<span class="number">640</span>, <span class="built_in">help</span>=<span class="string">&#x27;train, val åœ–åƒå¤§å°ï¼ˆåƒç´ ï¼‰&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--rect&#x27;</span>, action=<span class="string">&#x27;store_true&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;çŸ©å½¢è¨“ç·´&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--resume&#x27;</span>, nargs=<span class="string">&#x27;?&#x27;</span>, const=<span class="literal">True</span>, default=<span class="literal">False</span>, <span class="built_in">help</span>=<span class="string">&#x27;æ¢å¾©æœ€è¿‘çš„è¨“ç·´&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--nosave&#x27;</span>, action=<span class="string">&#x27;store_true&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;åªä¿å­˜æœ€å¾Œçš„æª¢æŸ¥é»&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--noval&#x27;</span>, action=<span class="string">&#x27;store_true&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;åªé©—è­‰æœ€çµ‚epoch&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--noautoanchor&#x27;</span>, action=<span class="string">&#x27;store_true&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;ç¦ç”¨è‡ªå‹•éŒ¨é»&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--noplots&#x27;</span>, action=<span class="string">&#x27;store_true&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;ä¸ä¿å­˜ç¹ªåœ–æ–‡ä»¶&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--evolve&#x27;</span>, <span class="built_in">type</span>=<span class="built_in">int</span>, nargs=<span class="string">&#x27;?&#x27;</span>, const=<span class="number">300</span>, <span class="built_in">help</span>=<span class="string">&#x27;evolve hyperparameters for x generations&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--bucket&#x27;</span>, <span class="built_in">type</span>=<span class="built_in">str</span>, default=<span class="string">&#x27;&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;gsutil bucket&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--cache&#x27;</span>, <span class="built_in">type</span>=<span class="built_in">str</span>, nargs=<span class="string">&#x27;?&#x27;</span>, const=<span class="string">&#x27;ram&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;åœ–åƒ--ç·©å­˜å…§å­˜/ç£ç›¤&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--image-weights&#x27;</span>, action=<span class="string">&#x27;store_true&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;ä½¿ç”¨weightedåœ–åƒé¸æ“‡é€²è¡Œè¨“ç·´&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--device&#x27;</span>, default=<span class="string">&#x27;&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;cuda è¨­å‚™ï¼Œå³ 0 æˆ– 0,1,2,3 æˆ– cpu&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--multi-scale&#x27;</span>, action=<span class="string">&#x27;store_true&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;vary img-size +/- 50%%&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--single-cls&#x27;</span>, action=<span class="string">&#x27;store_true&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;å°‡å¤šé¡æ•¸æ“šè¨“ç·´ç‚ºå–®é¡&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--optimizer&#x27;</span>, <span class="built_in">type</span>=<span class="built_in">str</span>, choices=[<span class="string">&#x27;SGD&#x27;</span>, <span class="string">&#x27;Adam&#x27;</span>, <span class="string">&#x27;AdamW&#x27;</span>], default=<span class="string">&#x27;SGD&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;å„ªåŒ–å™¨&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--sync-bn&#x27;</span>, action=<span class="string">&#x27;store_true&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;ä½¿ç”¨ SyncBatchNormï¼Œåƒ…åœ¨ DDP æ¨¡å¼ä¸‹å¯ç”¨&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--workers&#x27;</span>, <span class="built_in">type</span>=<span class="built_in">int</span>, default=<span class="number">8</span>, <span class="built_in">help</span>=<span class="string">&#x27;æœ€å¤§æ•¸æ“šåŠ è¼‰å™¨å·¥ä½œäººå“¡ï¼ˆåœ¨ DDP æ¨¡å¼ä¸‹æŒ‰ RANKï¼‰&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--project&#x27;</span>, default=ROOT / <span class="string">&#x27;runs/train&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;ä¿å­˜åˆ°é …ç›®/åç¨±&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--name&#x27;</span>, default=<span class="string">&#x27;exp&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;ä¿å­˜åˆ°é …ç›®/åç¨±&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--exist-ok&#x27;</span>, action=<span class="string">&#x27;store_true&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;ç¾æœ‰é …ç›®/åç¨±OKï¼Œä¸è¦å¢åŠ &#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--quad&#x27;</span>, action=<span class="string">&#x27;store_true&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;quad dataloader&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--cos-lr&#x27;</span>, action=<span class="string">&#x27;store_true&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;cosine LR scheduler&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--label-smoothing&#x27;</span>, <span class="built_in">type</span>=<span class="built_in">float</span>, default=<span class="number">0.0</span>, <span class="built_in">help</span>=<span class="string">&#x27;Label smoothing epsilon&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--patience&#x27;</span>, <span class="built_in">type</span>=<span class="built_in">int</span>, default=<span class="number">100</span>, <span class="built_in">help</span>=<span class="string">&#x27;EarlyStopping patience (epochs without improvement)&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--freeze&#x27;</span>, nargs=<span class="string">&#x27;+&#x27;</span>, <span class="built_in">type</span>=<span class="built_in">int</span>, default=[<span class="number">0</span>], <span class="built_in">help</span>=<span class="string">&#x27;Freeze layers: backbone=10, first3=0 1 2&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--save-period&#x27;</span>, <span class="built_in">type</span>=<span class="built_in">int</span>, default=-<span class="number">1</span>, <span class="built_in">help</span>=<span class="string">&#x27;Save checkpoint every x epochs (disabled if &lt; 1)&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--seed&#x27;</span>, <span class="built_in">type</span>=<span class="built_in">int</span>, default=<span class="number">0</span>, <span class="built_in">help</span>=<span class="string">&#x27;Global training seed&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--local_rank&#x27;</span>, <span class="built_in">type</span>=<span class="built_in">int</span>, default=-<span class="number">1</span>, <span class="built_in">help</span>=<span class="string">&#x27;è‡ªå‹• DDP Multi-GPU åƒæ•¸ï¼Œè«‹å‹¿ä¿®æ”¹&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è¨˜éŒ„å™¨åƒæ•¸</span></span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--entity&#x27;</span>, default=<span class="literal">None</span>, <span class="built_in">help</span>=<span class="string">&#x27;å¯¦é«”&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--upload_dataset&#x27;</span>, nargs=<span class="string">&#x27;?&#x27;</span>, const=<span class="literal">True</span>, default=<span class="literal">False</span>, <span class="built_in">help</span>=<span class="string">&#x27;ä¸Šå‚³æ•¸æ“šï¼Œâ€œvalâ€é¸é …&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--bbox_interval&#x27;</span>, <span class="built_in">type</span>=<span class="built_in">int</span>, default=-<span class="number">1</span>, <span class="built_in">help</span>=<span class="string">&#x27;è¨­ç½®é‚Šç•Œæ¡†åœ–åƒè¨˜éŒ„é–“éš”&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--artifact_alias&#x27;</span>, <span class="built_in">type</span>=<span class="built_in">str</span>, default=<span class="string">&#x27;latest&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;è¦ä½¿ç”¨çš„æ•¸æ“šé›†å·¥ä»¶ç‰ˆæœ¬&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> parser.parse_known_args()[<span class="number">0</span>] <span class="keyword">if</span> known <span class="keyword">else</span> parser.parse_args()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>(<span class="params">opt, callbacks=Callbacks(<span class="params"></span>)</span>):</span><br><span class="line">    <span class="comment"># Checks</span></span><br><span class="line">    <span class="keyword">if</span> RANK <span class="keyword">in</span> &#123;-<span class="number">1</span>, <span class="number">0</span>&#125;:</span><br><span class="line">        print_args(<span class="built_in">vars</span>(opt))</span><br><span class="line">        check_git_status()</span><br><span class="line">        check_requirements()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Resume (from specified or most recent last.pt)</span></span><br><span class="line">    <span class="keyword">if</span> opt.resume <span class="keyword">and</span> <span class="keyword">not</span> check_comet_resume(opt) <span class="keyword">and</span> <span class="keyword">not</span> opt.evolve:</span><br><span class="line">        last = Path(check_file(opt.resume) <span class="keyword">if</span> <span class="built_in">isinstance</span>(opt.resume, <span class="built_in">str</span>) <span class="keyword">else</span> get_latest_run())</span><br><span class="line">        opt_yaml = last.parent.parent / <span class="string">&#x27;opt.yaml&#x27;</span>  <span class="comment"># train options yaml</span></span><br><span class="line">        opt_data = opt.data  <span class="comment"># original dataset</span></span><br><span class="line">        <span class="keyword">if</span> opt_yaml.is_file():</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(opt_yaml, errors=<span class="string">&#x27;ignore&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                d = yaml.safe_load(f)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            d = torch.load(last, map_location=<span class="string">&#x27;cpu&#x27;</span>)[<span class="string">&#x27;opt&#x27;</span>]</span><br><span class="line">        opt = argparse.Namespace(**d)  <span class="comment"># replace</span></span><br><span class="line">        opt.cfg, opt.weights, opt.resume = <span class="string">&#x27;&#x27;</span>, <span class="built_in">str</span>(last), <span class="literal">True</span>  <span class="comment"># reinstate</span></span><br><span class="line">        <span class="keyword">if</span> is_url(opt_data):</span><br><span class="line">            opt.data = check_file(opt_data)  <span class="comment"># avoid HUB resume auth timeout</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        opt.data, opt.cfg, opt.hyp, opt.weights, opt.project = \</span><br><span class="line">            check_file(opt.data), check_yaml(opt.cfg), check_yaml(opt.hyp), <span class="built_in">str</span>(opt.weights), <span class="built_in">str</span>(opt.project)  <span class="comment"># checks</span></span><br><span class="line">        <span class="keyword">assert</span> <span class="built_in">len</span>(opt.cfg) <span class="keyword">or</span> <span class="built_in">len</span>(opt.weights), <span class="string">&#x27;either --cfg or --weights must be specified&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> opt.evolve:</span><br><span class="line">            <span class="keyword">if</span> opt.project == <span class="built_in">str</span>(ROOT / <span class="string">&#x27;runs/train&#x27;</span>):  <span class="comment"># if default project name, rename to runs/evolve</span></span><br><span class="line">                opt.project = <span class="built_in">str</span>(ROOT / <span class="string">&#x27;runs/evolve&#x27;</span>)</span><br><span class="line">            opt.exist_ok, opt.resume = opt.resume, <span class="literal">False</span>  <span class="comment"># pass resume to exist_ok and disable resume</span></span><br><span class="line">        <span class="keyword">if</span> opt.name == <span class="string">&#x27;cfg&#x27;</span>:</span><br><span class="line">            opt.name = Path(opt.cfg).stem  <span class="comment"># use model.yaml as name</span></span><br><span class="line">        opt.save_dir = <span class="built_in">str</span>(increment_path(Path(opt.project) / opt.name, exist_ok=opt.exist_ok))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># DDP mode</span></span><br><span class="line">    device = select_device(opt.device, batch_size=opt.batch_size)</span><br><span class="line">    <span class="keyword">if</span> LOCAL_RANK != -<span class="number">1</span>:</span><br><span class="line">        msg = <span class="string">&#x27;is not compatible with YOLOv5 Multi-GPU DDP training&#x27;</span></span><br><span class="line">        <span class="keyword">assert</span> <span class="keyword">not</span> opt.image_weights, <span class="string">f&#x27;--image-weights <span class="subst">&#123;msg&#125;</span>&#x27;</span></span><br><span class="line">        <span class="keyword">assert</span> <span class="keyword">not</span> opt.evolve, <span class="string">f&#x27;--evolve <span class="subst">&#123;msg&#125;</span>&#x27;</span></span><br><span class="line">        <span class="keyword">assert</span> opt.batch_size != -<span class="number">1</span>, <span class="string">f&#x27;AutoBatch with --batch-size -1 <span class="subst">&#123;msg&#125;</span>, please pass a valid --batch-size&#x27;</span></span><br><span class="line">        <span class="keyword">assert</span> opt.batch_size % WORLD_SIZE == <span class="number">0</span>, <span class="string">f&#x27;--batch-size <span class="subst">&#123;opt.batch_size&#125;</span> must be multiple of WORLD_SIZE&#x27;</span></span><br><span class="line">        <span class="keyword">assert</span> torch.cuda.device_count() &gt; LOCAL_RANK, <span class="string">&#x27;insufficient CUDA devices for DDP command&#x27;</span></span><br><span class="line">        torch.cuda.set_device(LOCAL_RANK)</span><br><span class="line">        device = torch.device(<span class="string">&#x27;cuda&#x27;</span>, LOCAL_RANK)</span><br><span class="line">        dist.init_process_group(backend=<span class="string">&quot;nccl&quot;</span> <span class="keyword">if</span> dist.is_nccl_available() <span class="keyword">else</span> <span class="string">&quot;gloo&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Train</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> opt.evolve:</span><br><span class="line">        train(opt.hyp, opt, device, callbacks)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Evolve hyperparameters (optional)</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># Hyperparameter evolution metadata (mutation scale 0-1, lower_limit, upper_limit)</span></span><br><span class="line">        meta = &#123;</span><br><span class="line">            <span class="string">&#x27;lr0&#x27;</span>: (<span class="number">1</span>, <span class="number">1e-5</span>, <span class="number">1e-1</span>),  <span class="comment"># initial learning rate (SGD=1E-2, Adam=1E-3)</span></span><br><span class="line">            <span class="string">&#x27;lrf&#x27;</span>: (<span class="number">1</span>, <span class="number">0.01</span>, <span class="number">1.0</span>),  <span class="comment"># final OneCycleLR learning rate (lr0 * lrf)</span></span><br><span class="line">            <span class="string">&#x27;momentum&#x27;</span>: (<span class="number">0.3</span>, <span class="number">0.6</span>, <span class="number">0.98</span>),  <span class="comment"># SGD momentum/Adam beta1</span></span><br><span class="line">            <span class="string">&#x27;weight_decay&#x27;</span>: (<span class="number">1</span>, <span class="number">0.0</span>, <span class="number">0.001</span>),  <span class="comment"># optimizer weight decay</span></span><br><span class="line">            <span class="string">&#x27;warmup_epochs&#x27;</span>: (<span class="number">1</span>, <span class="number">0.0</span>, <span class="number">5.0</span>),  <span class="comment"># warmup epochs (fractions ok)</span></span><br><span class="line">            <span class="string">&#x27;warmup_momentum&#x27;</span>: (<span class="number">1</span>, <span class="number">0.0</span>, <span class="number">0.95</span>),  <span class="comment"># warmup initial momentum</span></span><br><span class="line">            <span class="string">&#x27;warmup_bias_lr&#x27;</span>: (<span class="number">1</span>, <span class="number">0.0</span>, <span class="number">0.2</span>),  <span class="comment"># warmup initial bias lr</span></span><br><span class="line">            <span class="string">&#x27;box&#x27;</span>: (<span class="number">1</span>, <span class="number">0.02</span>, <span class="number">0.2</span>),  <span class="comment"># box loss gain</span></span><br><span class="line">            <span class="string">&#x27;cls&#x27;</span>: (<span class="number">1</span>, <span class="number">0.2</span>, <span class="number">4.0</span>),  <span class="comment"># cls loss gain</span></span><br><span class="line">            <span class="string">&#x27;cls_pw&#x27;</span>: (<span class="number">1</span>, <span class="number">0.5</span>, <span class="number">2.0</span>),  <span class="comment"># cls BCELoss positive_weight</span></span><br><span class="line">            <span class="string">&#x27;obj&#x27;</span>: (<span class="number">1</span>, <span class="number">0.2</span>, <span class="number">4.0</span>),  <span class="comment"># obj loss gain (scale with pixels)</span></span><br><span class="line">            <span class="string">&#x27;obj_pw&#x27;</span>: (<span class="number">1</span>, <span class="number">0.5</span>, <span class="number">2.0</span>),  <span class="comment"># obj BCELoss positive_weight</span></span><br><span class="line">            <span class="string">&#x27;iou_t&#x27;</span>: (<span class="number">0</span>, <span class="number">0.1</span>, <span class="number">0.7</span>),  <span class="comment"># IoU training threshold</span></span><br><span class="line">            <span class="string">&#x27;anchor_t&#x27;</span>: (<span class="number">1</span>, <span class="number">2.0</span>, <span class="number">8.0</span>),  <span class="comment"># anchor-multiple threshold</span></span><br><span class="line">            <span class="string">&#x27;anchors&#x27;</span>: (<span class="number">2</span>, <span class="number">2.0</span>, <span class="number">10.0</span>),  <span class="comment"># anchors per output grid (0 to ignore)</span></span><br><span class="line">            <span class="string">&#x27;fl_gamma&#x27;</span>: (<span class="number">0</span>, <span class="number">0.0</span>, <span class="number">2.0</span>),  <span class="comment"># focal loss gamma (efficientDet default gamma=1.5)</span></span><br><span class="line">            <span class="string">&#x27;hsv_h&#x27;</span>: (<span class="number">1</span>, <span class="number">0.0</span>, <span class="number">0.1</span>),  <span class="comment"># image HSV-Hue augmentation (fraction)</span></span><br><span class="line">            <span class="string">&#x27;hsv_s&#x27;</span>: (<span class="number">1</span>, <span class="number">0.0</span>, <span class="number">0.9</span>),  <span class="comment"># image HSV-Saturation augmentation (fraction)</span></span><br><span class="line">            <span class="string">&#x27;hsv_v&#x27;</span>: (<span class="number">1</span>, <span class="number">0.0</span>, <span class="number">0.9</span>),  <span class="comment"># image HSV-Value augmentation (fraction)</span></span><br><span class="line">            <span class="string">&#x27;degrees&#x27;</span>: (<span class="number">1</span>, <span class="number">0.0</span>, <span class="number">45.0</span>),  <span class="comment"># image rotation (+/- deg)</span></span><br><span class="line">            <span class="string">&#x27;translate&#x27;</span>: (<span class="number">1</span>, <span class="number">0.0</span>, <span class="number">0.9</span>),  <span class="comment"># image translation (+/- fraction)</span></span><br><span class="line">            <span class="string">&#x27;scale&#x27;</span>: (<span class="number">1</span>, <span class="number">0.0</span>, <span class="number">0.9</span>),  <span class="comment"># image scale (+/- gain)</span></span><br><span class="line">            <span class="string">&#x27;shear&#x27;</span>: (<span class="number">1</span>, <span class="number">0.0</span>, <span class="number">10.0</span>),  <span class="comment"># image shear (+/- deg)</span></span><br><span class="line">            <span class="string">&#x27;perspective&#x27;</span>: (<span class="number">0</span>, <span class="number">0.0</span>, <span class="number">0.001</span>),  <span class="comment"># image perspective (+/- fraction), range 0-0.001</span></span><br><span class="line">            <span class="string">&#x27;flipud&#x27;</span>: (<span class="number">1</span>, <span class="number">0.0</span>, <span class="number">1.0</span>),  <span class="comment"># image flip up-down (probability)</span></span><br><span class="line">            <span class="string">&#x27;fliplr&#x27;</span>: (<span class="number">0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>),  <span class="comment"># image flip left-right (probability)</span></span><br><span class="line">            <span class="string">&#x27;mosaic&#x27;</span>: (<span class="number">1</span>, <span class="number">0.0</span>, <span class="number">1.0</span>),  <span class="comment"># image mixup (probability)</span></span><br><span class="line">            <span class="string">&#x27;mixup&#x27;</span>: (<span class="number">1</span>, <span class="number">0.0</span>, <span class="number">1.0</span>),  <span class="comment"># image mixup (probability)</span></span><br><span class="line">            <span class="string">&#x27;copy_paste&#x27;</span>: (<span class="number">1</span>, <span class="number">0.0</span>, <span class="number">1.0</span>)&#125;  <span class="comment"># segment copy-paste (probability)</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(opt.hyp, errors=<span class="string">&#x27;ignore&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            hyp = yaml.safe_load(f)  <span class="comment"># load hyps dict</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;anchors&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> hyp:  <span class="comment"># anchors commented in hyp.yaml</span></span><br><span class="line">                hyp[<span class="string">&#x27;anchors&#x27;</span>] = <span class="number">3</span></span><br><span class="line">        <span class="keyword">if</span> opt.noautoanchor:</span><br><span class="line">            <span class="keyword">del</span> hyp[<span class="string">&#x27;anchors&#x27;</span>], meta[<span class="string">&#x27;anchors&#x27;</span>]</span><br><span class="line">        opt.noval, opt.nosave, save_dir = <span class="literal">True</span>, <span class="literal">True</span>, Path(opt.save_dir)  <span class="comment"># only val/save final epoch</span></span><br><span class="line">        <span class="comment"># ei = [isinstance(x, (int, float)) for x in hyp.values()]  # evolvable indices</span></span><br><span class="line">        evolve_yaml, evolve_csv = save_dir / <span class="string">&#x27;hyp_evolve.yaml&#x27;</span>, save_dir / <span class="string">&#x27;evolve.csv&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> opt.bucket:</span><br><span class="line">            os.system(<span class="string">f&#x27;gsutil cp gs://<span class="subst">&#123;opt.bucket&#125;</span>/evolve.csv <span class="subst">&#123;evolve_csv&#125;</span>&#x27;</span>)  <span class="comment"># download evolve.csv if exists</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(opt.evolve):  <span class="comment"># generations to evolve</span></span><br><span class="line">            <span class="keyword">if</span> evolve_csv.exists():  <span class="comment"># if evolve.csv exists: select best hyps and mutate</span></span><br><span class="line">                <span class="comment"># Select parent(s)</span></span><br><span class="line">                parent = <span class="string">&#x27;single&#x27;</span>  <span class="comment"># parent selection method: &#x27;single&#x27; or &#x27;weighted&#x27;</span></span><br><span class="line">                x = np.loadtxt(evolve_csv, ndmin=<span class="number">2</span>, delimiter=<span class="string">&#x27;,&#x27;</span>, skiprows=<span class="number">1</span>)</span><br><span class="line">                n = <span class="built_in">min</span>(<span class="number">5</span>, <span class="built_in">len</span>(x))  <span class="comment"># number of previous results to consider</span></span><br><span class="line">                x = x[np.argsort(-fitness(x))][:n]  <span class="comment"># top n mutations</span></span><br><span class="line">                w = fitness(x) - fitness(x).<span class="built_in">min</span>() + <span class="number">1E-6</span>  <span class="comment"># weights (sum &gt; 0)</span></span><br><span class="line">                <span class="keyword">if</span> parent == <span class="string">&#x27;single&#x27;</span> <span class="keyword">or</span> <span class="built_in">len</span>(x) == <span class="number">1</span>:</span><br><span class="line">                    <span class="comment"># x = x[random.randint(0, n - 1)]  # random selection</span></span><br><span class="line">                    x = x[random.choices(<span class="built_in">range</span>(n), weights=w)[<span class="number">0</span>]]  <span class="comment"># weighted selection</span></span><br><span class="line">                <span class="keyword">elif</span> parent == <span class="string">&#x27;weighted&#x27;</span>:</span><br><span class="line">                    x = (x * w.reshape(n, <span class="number">1</span>)).<span class="built_in">sum</span>(<span class="number">0</span>) / w.<span class="built_in">sum</span>()  <span class="comment"># weighted combination</span></span><br><span class="line"></span><br><span class="line">                <span class="comment"># Mutate</span></span><br><span class="line">                mp, s = <span class="number">0.8</span>, <span class="number">0.2</span>  <span class="comment"># mutation probability, sigma</span></span><br><span class="line">                npr = np.random</span><br><span class="line">                npr.seed(<span class="built_in">int</span>(time.time()))</span><br><span class="line">                g = np.array([meta[k][<span class="number">0</span>] <span class="keyword">for</span> k <span class="keyword">in</span> hyp.keys()])  <span class="comment"># gains 0-1</span></span><br><span class="line">                ng = <span class="built_in">len</span>(meta)</span><br><span class="line">                v = np.ones(ng)</span><br><span class="line">                <span class="keyword">while</span> <span class="built_in">all</span>(v == <span class="number">1</span>):  <span class="comment"># mutate until a change occurs (prevent duplicates)</span></span><br><span class="line">                    v = (g * (npr.random(ng) &lt; mp) * npr.randn(ng) * npr.random() * s + <span class="number">1</span>).clip(<span class="number">0.3</span>, <span class="number">3.0</span>)</span><br><span class="line">                <span class="keyword">for</span> i, k <span class="keyword">in</span> <span class="built_in">enumerate</span>(hyp.keys()):  <span class="comment"># plt.hist(v.ravel(), 300)</span></span><br><span class="line">                    hyp[k] = <span class="built_in">float</span>(x[i + <span class="number">7</span>] * v[i])  <span class="comment"># mutate</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># Constrain to limits</span></span><br><span class="line">            <span class="keyword">for</span> k, v <span class="keyword">in</span> meta.items():</span><br><span class="line">                hyp[k] = <span class="built_in">max</span>(hyp[k], v[<span class="number">1</span>])  <span class="comment"># lower limit</span></span><br><span class="line">                hyp[k] = <span class="built_in">min</span>(hyp[k], v[<span class="number">2</span>])  <span class="comment"># upper limit</span></span><br><span class="line">                hyp[k] = <span class="built_in">round</span>(hyp[k], <span class="number">5</span>)  <span class="comment"># significant digits</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># Train mutation</span></span><br><span class="line">            results = train(hyp.copy(), opt, device, callbacks)</span><br><span class="line">            callbacks = Callbacks()</span><br><span class="line">            <span class="comment"># Write mutation results</span></span><br><span class="line">            keys = (<span class="string">&#x27;metrics/precision&#x27;</span>, <span class="string">&#x27;metrics/recall&#x27;</span>, <span class="string">&#x27;metrics/mAP_0.5&#x27;</span>, <span class="string">&#x27;metrics/mAP_0.5:0.95&#x27;</span>, <span class="string">&#x27;val/box_loss&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;val/obj_loss&#x27;</span>, <span class="string">&#x27;val/cls_loss&#x27;</span>)</span><br><span class="line">            print_mutation(keys, results, hyp.copy(), save_dir, opt.bucket)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Plot results</span></span><br><span class="line">        plot_evolve(evolve_csv)</span><br><span class="line">        LOGGER.info(<span class="string">f&#x27;Hyperparameter evolution finished <span class="subst">&#123;opt.evolve&#125;</span> generations\n&#x27;</span></span><br><span class="line">                    <span class="string">f&quot;Results saved to <span class="subst">&#123;colorstr(<span class="string">&#x27;bold&#x27;</span>, save_dir)&#125;</span>\n&quot;</span></span><br><span class="line">                    <span class="string">f&#x27;Usage example: $ python train.py --hyp <span class="subst">&#123;evolve_yaml&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">**kwargs</span>):</span><br><span class="line">    <span class="comment"># Usage: import train; train.run(data=&#x27;coco128.yaml&#x27;, imgsz=320, weights=&#x27;yolov5m.pt&#x27;)</span></span><br><span class="line">    opt = parse_opt(<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> kwargs.items():</span><br><span class="line">        <span class="built_in">setattr</span>(opt, k, v)</span><br><span class="line">    main(opt)</span><br><span class="line">    <span class="keyword">return</span> opt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    opt = parse_opt()</span><br><span class="line">    main(opt)</span><br></pre></td></tr></table></figure>

</details>

<hr>
<h1 id="åœ–ç‰‡-amp-å½±ç‰‡-amp-ä¸²æµã€æª¢æ¸¬ã€‘"><a href="#åœ–ç‰‡-amp-å½±ç‰‡-amp-ä¸²æµã€æª¢æ¸¬ã€‘" class="headerlink" title="åœ–ç‰‡&amp;å½±ç‰‡&amp;ä¸²æµã€æª¢æ¸¬ã€‘"></a>åœ–ç‰‡&amp;å½±ç‰‡&amp;ä¸²æµã€æª¢æ¸¬ã€‘</h1><p>é™¤äº†å¯åµæ¸¬åœ–ç‰‡å¤–ï¼Œä¹Ÿèƒ½åµæ¸¬å½±ç‰‡ã€è³‡æ–™å¤¾ã€webcamã€å³æ™‚ä¸²æµã€ç¶²é ä¸Šçš„å½±ç‰‡</p>
<ul>
<li>ç¯„ä¾‹ï¼ˆå³æ™‚è¾¨è­˜ï¼‰ï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python detect.py --weights best.pt --conf-thres 0.5 --img-size 640 --view-img --name detect-run --project runs/detect --save-crop --save-txt --vid-stride 20 --source 0</span><br></pre></td></tr></table></figure>
<code>--weights</code> ï¼šå‰‡å¯ç”¨ä¾†æŒ‡å®šé è¨“ç·´çš„æ¨¡å‹ã€‚exï¼š<code>--weights best.pt</code><br><code>--source</code>ï¼š<code>file.jpg</code>#åœ–ç‰‡ã€<code>file.mp4</code>#å½±ç‰‡ã€<code>dir/</code>#è³‡æ–™å¤¾ã€<code>0</code>#æ”åƒé ­(å³æ™‚è¾¨è­˜)ã€‚<br><code>--img-size</code> ï¼šå¯ä»¥æŒ‡å®šå½±åƒçš„å¤§å°ï¼Œå°æ–¼åµæ¸¬æ¯”è¼ƒå°çš„ç‰©ä»¶æ™‚ï¼Œå¯ä»¥åŠ å¤§å½±åƒçš„å¤§å°ï¼Œé è¨­çš„å½±åƒå¤§å°ç‚º 640ã€‚<br><code>--iou-thres</code> ï¼šæ˜¯è¨­å®š IoU é–€æª»å€¼ã€‚<br><code>--conf-thres</code> ï¼šå‰‡æ˜¯è¨­å®šä¿¡å¿ƒåº¦é–€æª»å€¼ã€‚<br><code>--cuda device</code> ï¼šé è¨­0ï¼Œå¯èª¿æ•´0,1,2,3 or cpuã€‚<br><code>--save-txt</code>ï¼šä¿å­˜çµæœåˆ°*.txtã€‚<br><code>--save-conf</code>ï¼šåœ¨ â€“save-txt æ¨™ç±¤ä¸­ä¿å­˜ä¿¡å¿ƒã€‚<br><code>--view-img</code>ï¼šé¡¯ç¤ºè¦–çª—åœ–ç‰‡ã€‚<br><code>--nosave</code>ï¼šä¸ä¿å­˜åœ–ç‰‡&#x2F;è¦–é »ã€‚<br><code>--classes</code>ï¼šæŒ‰é¡åˆ¥éæ¿¾ï¼Œå¦‚ã€â€“class 0, or â€“class 0 2 3ã€‘ã€‚<br><code>--update</code>ï¼šæ›´æ–°æ‰€æœ‰æ¨¡å‹ã€‚<br><code>--project</code>ï¼šå°‡é©—è­‰çµæœä¿å­˜åˆ°è‡ªè¨‚è³‡æ–™å¤¾ã€‚exï¼š<code>--project runs/detect</code><br><code>--name</code>ï¼šå°‡çµæœä¿å­˜åˆ°é …ç›®&#x2F;åç¨±ã€‚exï¼š<code>--name yolov5s-detect</code><br><code>--exist-ok</code>ï¼šç¾æœ‰é …ç›®&#x2F;åç¨±okï¼Œä¸éå¢ã€‚<ul>
<li><font color="red">ï¼ˆæŸ¥çœ‹æ›´å¤šæŒ‡ä»¤èªªæ˜ï¼‰ï¼š</font><blockquote>
<p>åœ¨ <code>Anaconda Prompt (yolov5)</code> ä¸Šè¼¸å…¥ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python detect.py -h</span><br></pre></td></tr></table></figure></blockquote>
</li>
</ul>
</li>
</ul>
<h2 id="detect-py"><a href="#detect-py" class="headerlink" title="detect.py"></a>detect.py</h2><details>
<summary><font color="red">detect.py ä¸­æ–‡ä¿®æ”¹è£œå……ï¼ˆé»æ“Šå±•é–‹ï¼‰</font></summary>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># YOLOv5 ğŸš€ by Ultralytics, GPL-3.0 license</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">é‹è¡ŒYOLOv5æª¢æ¸¬æ¨æ–·åœ–åƒï¼Œè¦–é »ï¼Œç›®éŒ„ï¼Œglob, YouTubeï¼Œç¶²çµ¡æ”åƒé ­ï¼Œetcç­‰ã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">ç”¨æ³• - ä¾†æºï¼š</span></span><br><span class="line"><span class="string">    $ python detect.py --weights yolov5s.pt --source 0                               # webcam</span></span><br><span class="line"><span class="string">                                                     img.jpg                         # image</span></span><br><span class="line"><span class="string">                                                     vid.mp4                         # video</span></span><br><span class="line"><span class="string">                                                     screen                          # screenshot</span></span><br><span class="line"><span class="string">                                                     path/                           # directory</span></span><br><span class="line"><span class="string">                                                     &#x27;path/*.jpg&#x27;                    # glob</span></span><br><span class="line"><span class="string">                                                     &#x27;https://youtu.be/Zgi9g1ksQHc&#x27;  # YouTube</span></span><br><span class="line"><span class="string">                                                     &#x27;rtsp://example.com/media.mp4&#x27;  # RTSP, RTMP, HTTP stream</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">ç”¨æ³• - æ ¼å¼ï¼š</span></span><br><span class="line"><span class="string">    $ python detect.py --weights yolov5s.pt                 # PyTorch</span></span><br><span class="line"><span class="string">                                 yolov5s.torchscript        # TorchScript</span></span><br><span class="line"><span class="string">                                 yolov5s.onnx               # ONNX Runtime or OpenCV DNN with --dnn</span></span><br><span class="line"><span class="string">                                 yolov5s_openvino_model     # OpenVINO</span></span><br><span class="line"><span class="string">                                 yolov5s.engine             # TensorRT</span></span><br><span class="line"><span class="string">                                 yolov5s.mlmodel            # CoreML (macOS-only)</span></span><br><span class="line"><span class="string">                                 yolov5s_saved_model        # TensorFlow SavedModel</span></span><br><span class="line"><span class="string">                                 yolov5s.pb                 # TensorFlow GraphDef</span></span><br><span class="line"><span class="string">                                 yolov5s.tflite             # TensorFlow Lite</span></span><br><span class="line"><span class="string">                                 yolov5s_edgetpu.tflite     # TensorFlow Edge TPU</span></span><br><span class="line"><span class="string">                                 yolov5s_paddle_model       # PaddlePaddle</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> platform</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"></span><br><span class="line">FILE = Path(__file__).resolve()</span><br><span class="line">ROOT = FILE.parents[<span class="number">0</span>]  <span class="comment"># YOLOv5 root directory</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">str</span>(ROOT) <span class="keyword">not</span> <span class="keyword">in</span> sys.path:</span><br><span class="line">    sys.path.append(<span class="built_in">str</span>(ROOT))  <span class="comment"># å°‡ ROOT æ·»åŠ åˆ° PATH</span></span><br><span class="line">ROOT = Path(os.path.relpath(ROOT, Path.cwd()))  <span class="comment"># relative</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> models.common <span class="keyword">import</span> DetectMultiBackend</span><br><span class="line"><span class="keyword">from</span> utils.dataloaders <span class="keyword">import</span> IMG_FORMATS, VID_FORMATS, LoadImages, LoadScreenshots, LoadStreams</span><br><span class="line"><span class="keyword">from</span> utils.general <span class="keyword">import</span> (LOGGER, Profile, check_file, check_img_size, check_imshow, check_requirements, colorstr, cv2,</span><br><span class="line">                           increment_path, non_max_suppression, print_args, scale_boxes, strip_optimizer, xyxy2xywh)</span><br><span class="line"><span class="keyword">from</span> utils.plots <span class="keyword">import</span> Annotator, colors, save_one_box</span><br><span class="line"><span class="keyword">from</span> utils.torch_utils <span class="keyword">import</span> select_device, smart_inference_mode</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@smart_inference_mode()</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">run</span>(<span class="params"></span></span><br><span class="line"><span class="params">        weights=ROOT / <span class="string">&#x27;yolov5s.pt&#x27;</span>,  <span class="comment"># æ¨¡å‹è·¯å¾‘æˆ– triton URL</span></span></span><br><span class="line"><span class="params">        source=ROOT / <span class="string">&#x27;data/images&#x27;</span>,  <span class="comment"># æ–‡ä»¶/ç›®éŒ„/URL/glob/screen/0ï¼ˆç¶²çµ¡æ”åƒé ­ï¼‰</span></span></span><br><span class="line"><span class="params">        data=ROOT / <span class="string">&#x27;data/coco128.yaml&#x27;</span>,  <span class="comment"># dataset.yamlè·¯å¾‘</span></span></span><br><span class="line"><span class="params">        imgsz=(<span class="params"><span class="number">640</span>, <span class="number">640</span></span>),  <span class="comment"># æ¨ç†å¤§å°ï¼ˆé«˜åº¦, å¯¬åº¦ï¼‰</span></span></span><br><span class="line"><span class="params">        conf_thres=<span class="number">0.25</span>,  <span class="comment"># confidence é–¾å€¼</span></span></span><br><span class="line"><span class="params">        iou_thres=<span class="number">0.45</span>,  <span class="comment"># NMS IOU é–¾å€¼</span></span></span><br><span class="line"><span class="params">        max_det=<span class="number">1000</span>,  <span class="comment"># æ¯å¼µåœ–ç‰‡çš„æœ€å¤§æª¢æ¸¬æ•¸</span></span></span><br><span class="line"><span class="params">        device=<span class="string">&#x27;&#x27;</span>,  <span class="comment"># cuda è¨­å‚™ï¼Œå³ 0 æˆ– 0,1,2,3 æˆ– cpu</span></span></span><br><span class="line"><span class="params">        view_img=<span class="literal">False</span>,  <span class="comment"># é¡¯ç¤ºçµæœ</span></span></span><br><span class="line"><span class="params">        save_txt=<span class="literal">False</span>,  <span class="comment"># å°‡çµæœä¿å­˜åˆ° *.txt</span></span></span><br><span class="line"><span class="params">        save_conf=<span class="literal">False</span>,  <span class="comment"># åœ¨ --save-txt æ¨™ç±¤ä¸­ä¿å­˜ä¿¡å¿ƒ</span></span></span><br><span class="line"><span class="params">        save_crop=<span class="literal">False</span>,  <span class="comment"># ä¿å­˜è£å‰ªçš„é æ¸¬æ¡†</span></span></span><br><span class="line"><span class="params">        nosave=<span class="literal">False</span>,  <span class="comment"># ä¸ä¿å­˜åœ–ç‰‡/è¦–é »</span></span></span><br><span class="line"><span class="params">        classes=<span class="literal">None</span>,  <span class="comment"># æŒ‰é¡åˆ¥éæ¿¾ï¼š--class 0ï¼Œæˆ–--class 0 2 3</span></span></span><br><span class="line"><span class="params">        agnostic_nms=<span class="literal">False</span>,  <span class="comment"># class-agnostic NMS</span></span></span><br><span class="line"><span class="params">        augment=<span class="literal">False</span>,  <span class="comment"># å¢å¼·æ¨ç†</span></span></span><br><span class="line"><span class="params">        visualize=<span class="literal">False</span>,  <span class="comment"># å¯è¦–åŒ–ç‰¹å¾µ</span></span></span><br><span class="line"><span class="params">        update=<span class="literal">False</span>,  <span class="comment"># æ›´æ–°æ‰€æœ‰æ¨¡å‹</span></span></span><br><span class="line"><span class="params">        project=ROOT / <span class="string">&#x27;runs/detect&#x27;</span>,  <span class="comment"># å°‡çµæœä¿å­˜åˆ°é …ç›®/åç¨±</span></span></span><br><span class="line"><span class="params">        name=<span class="string">&#x27;exp&#x27;</span>,  <span class="comment"># å°‡çµæœä¿å­˜åˆ°é …ç›®/åç¨±</span></span></span><br><span class="line"><span class="params">        exist_ok=<span class="literal">False</span>,  <span class="comment"># ç¾æœ‰é …ç›®/åç¨±å¯ä»¥ï¼Œä¸è¦å¢åŠ </span></span></span><br><span class="line"><span class="params">        line_thickness=<span class="number">3</span>,  <span class="comment"># é‚Šç•Œæ¡†åšåº¦ï¼ˆpixelsåƒç´ ï¼‰</span></span></span><br><span class="line"><span class="params">        hide_labels=<span class="literal">False</span>,  <span class="comment"># éš±è—æ¨™ç±¤</span></span></span><br><span class="line"><span class="params">        hide_conf=<span class="literal">False</span>,  <span class="comment"># hide confidences</span></span></span><br><span class="line"><span class="params">        half=<span class="literal">False</span>,  <span class="comment"># ä½¿ç”¨ FP16 åŠç²¾åº¦æ¨ç†</span></span></span><br><span class="line"><span class="params">        dnn=<span class="literal">False</span>,  <span class="comment"># ä½¿ç”¨ OpenCV DNN é€²è¡Œ ONNX æ¨ç†</span></span></span><br><span class="line"><span class="params">        vid_stride=<span class="number">1</span>,  <span class="comment"># è¦–é »å¹€ç‡æ­¥å¹…</span></span></span><br><span class="line"><span class="params"></span>):</span><br><span class="line">    source = <span class="built_in">str</span>(source)</span><br><span class="line">    save_img = <span class="keyword">not</span> nosave <span class="keyword">and</span> <span class="keyword">not</span> source.endswith(<span class="string">&#x27;.txt&#x27;</span>)  <span class="comment"># ä¿å­˜æ¨ç†åœ–åƒ</span></span><br><span class="line">    is_file = Path(source).suffix[<span class="number">1</span>:] <span class="keyword">in</span> (IMG_FORMATS + VID_FORMATS)</span><br><span class="line">    is_url = source.lower().startswith((<span class="string">&#x27;rtsp://&#x27;</span>, <span class="string">&#x27;rtmp://&#x27;</span>, <span class="string">&#x27;http://&#x27;</span>, <span class="string">&#x27;https://&#x27;</span>))</span><br><span class="line">    webcam = source.isnumeric() <span class="keyword">or</span> source.endswith(<span class="string">&#x27;.txt&#x27;</span>) <span class="keyword">or</span> (is_url <span class="keyword">and</span> <span class="keyword">not</span> is_file)</span><br><span class="line">    screenshot = source.lower().startswith(<span class="string">&#x27;screen&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> is_url <span class="keyword">and</span> is_file:</span><br><span class="line">        source = check_file(source)  <span class="comment"># download</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># ç›®éŒ„</span></span><br><span class="line">    save_dir = increment_path(Path(project) / name, exist_ok=exist_ok)  <span class="comment"># increment run</span></span><br><span class="line">    (save_dir / <span class="string">&#x27;labels&#x27;</span> <span class="keyword">if</span> save_txt <span class="keyword">else</span> save_dir).mkdir(parents=<span class="literal">True</span>, exist_ok=<span class="literal">True</span>)  <span class="comment"># make dir</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># åŠ è¼‰æ¨¡å‹</span></span><br><span class="line">    device = select_device(device)</span><br><span class="line">    model = DetectMultiBackend(weights, device=device, dnn=dnn, data=data, fp16=half)</span><br><span class="line">    stride, names, pt = model.stride, model.names, model.pt</span><br><span class="line">    imgsz = check_img_size(imgsz, s=stride)  <span class="comment"># æª¢æŸ¥åœ–åƒå¤§å°</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ•¸æ“šåŠ è¼‰å™¨</span></span><br><span class="line">    bs = <span class="number">1</span>  <span class="comment"># batch_size</span></span><br><span class="line">    <span class="keyword">if</span> webcam:</span><br><span class="line">        view_img = check_imshow(warn=<span class="literal">True</span>)</span><br><span class="line">        dataset = LoadStreams(source, img_size=imgsz, stride=stride, auto=pt, vid_stride=vid_stride)</span><br><span class="line">        bs = <span class="built_in">len</span>(dataset)</span><br><span class="line">    <span class="keyword">elif</span> screenshot:</span><br><span class="line">        dataset = LoadScreenshots(source, img_size=imgsz, stride=stride, auto=pt)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        dataset = LoadImages(source, img_size=imgsz, stride=stride, auto=pt, vid_stride=vid_stride)</span><br><span class="line">    vid_path, vid_writer = [<span class="literal">None</span>] * bs, [<span class="literal">None</span>] * bs</span><br><span class="line"></span><br><span class="line">    <span class="comment"># é‹è¡Œæ¨ç†</span></span><br><span class="line">    model.warmup(imgsz=(<span class="number">1</span> <span class="keyword">if</span> pt <span class="keyword">or</span> model.triton <span class="keyword">else</span> bs, <span class="number">3</span>, *imgsz))  <span class="comment"># warmup</span></span><br><span class="line">    seen, windows, dt = <span class="number">0</span>, [], (Profile(), Profile(), Profile())</span><br><span class="line">    <span class="keyword">for</span> path, im, im0s, vid_cap, s <span class="keyword">in</span> dataset:</span><br><span class="line">        <span class="keyword">with</span> dt[<span class="number">0</span>]:</span><br><span class="line">            im = torch.from_numpy(im).to(model.device)</span><br><span class="line">            im = im.half() <span class="keyword">if</span> model.fp16 <span class="keyword">else</span> im.<span class="built_in">float</span>()  <span class="comment"># uint8 to fp16/32</span></span><br><span class="line">            im /= <span class="number">255</span>  <span class="comment"># 0 - 255 to 0.0 - 1.0</span></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(im.shape) == <span class="number">3</span>:</span><br><span class="line">                im = im[<span class="literal">None</span>]  <span class="comment"># expand for batch dim</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># æ¨ç†</span></span><br><span class="line">        <span class="keyword">with</span> dt[<span class="number">1</span>]:</span><br><span class="line">            visualize = increment_path(save_dir / Path(path).stem, mkdir=<span class="literal">True</span>) <span class="keyword">if</span> visualize <span class="keyword">else</span> <span class="literal">False</span></span><br><span class="line">            pred = model(im, augment=augment, visualize=visualize)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># NMS</span></span><br><span class="line">        <span class="keyword">with</span> dt[<span class="number">2</span>]:</span><br><span class="line">            pred = non_max_suppression(pred, conf_thres, iou_thres, classes, agnostic_nms, max_det=max_det)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># ç¬¬äºŒéšæ®µåˆ†é¡å™¨ï¼ˆå¯é¸ï¼‰</span></span><br><span class="line">        <span class="comment"># pred = utils.general.apply_classifier(pred, classifier_model, im, im0s)</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># éç¨‹é æ¸¬</span></span><br><span class="line">        <span class="keyword">for</span> i, det <span class="keyword">in</span> <span class="built_in">enumerate</span>(pred):  <span class="comment"># æ¯å¼µåœ–ç‰‡</span></span><br><span class="line">            seen += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> webcam:  <span class="comment"># batch_size &gt;= 1</span></span><br><span class="line">                p, im0, frame = path[i], im0s[i].copy(), dataset.count</span><br><span class="line">                s += <span class="string">f&#x27;<span class="subst">&#123;i&#125;</span>: &#x27;</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                p, im0, frame = path, im0s.copy(), <span class="built_in">getattr</span>(dataset, <span class="string">&#x27;frame&#x27;</span>, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">            p = Path(p)  <span class="comment"># to Path</span></span><br><span class="line">            save_path = <span class="built_in">str</span>(save_dir / p.name)  <span class="comment"># im.jpg</span></span><br><span class="line">            txt_path = <span class="built_in">str</span>(save_dir / <span class="string">&#x27;labels&#x27;</span> / p.stem) + (<span class="string">&#x27;&#x27;</span> <span class="keyword">if</span> dataset.mode == <span class="string">&#x27;image&#x27;</span> <span class="keyword">else</span> <span class="string">f&#x27;_<span class="subst">&#123;frame&#125;</span>&#x27;</span>)  <span class="comment"># im.txt</span></span><br><span class="line">            s += <span class="string">&#x27;%gx%g &#x27;</span> % im.shape[<span class="number">2</span>:]  <span class="comment"># print string</span></span><br><span class="line">            gn = torch.tensor(im0.shape)[[<span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>]]  <span class="comment"># normalization gain whwh</span></span><br><span class="line">            imc = im0.copy() <span class="keyword">if</span> save_crop <span class="keyword">else</span> im0  <span class="comment"># for save_crop</span></span><br><span class="line">            annotator = Annotator(im0, line_width=line_thickness, example=<span class="built_in">str</span>(names))</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(det):</span><br><span class="line">                <span class="comment"># å°‡æ¡†å¾ img_size é‡æ–°ç¸®æ”¾ç‚º im0 å¤§å°</span></span><br><span class="line">                det[:, :<span class="number">4</span>] = scale_boxes(im.shape[<span class="number">2</span>:], det[:, :<span class="number">4</span>], im0.shape).<span class="built_in">round</span>()</span><br><span class="line"></span><br><span class="line">                <span class="comment"># Printçµæœ</span></span><br><span class="line">                <span class="keyword">for</span> c <span class="keyword">in</span> det[:, <span class="number">5</span>].unique():</span><br><span class="line">                    n = (det[:, <span class="number">5</span>] == c).<span class="built_in">sum</span>()  <span class="comment"># æ¯classæª¢æ¸¬</span></span><br><span class="line">                    s += <span class="string">f&quot;<span class="subst">&#123;n&#125;</span> <span class="subst">&#123;names[<span class="built_in">int</span>(c)]&#125;</span><span class="subst">&#123;<span class="string">&#x27;s&#x27;</span> * (n &gt; <span class="number">1</span>)&#125;</span>, &quot;</span>  <span class="comment"># add to string</span></span><br><span class="line"></span><br><span class="line">                <span class="comment"># Writeçµæœ</span></span><br><span class="line">                <span class="keyword">for</span> *xyxy, conf, cls <span class="keyword">in</span> <span class="built_in">reversed</span>(det):</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> save_txt:  <span class="comment"># Write to file</span></span><br><span class="line">                        xywh = (xyxy2xywh(torch.tensor(xyxy).view(<span class="number">1</span>, <span class="number">4</span>)) / gn).view(-<span class="number">1</span>).tolist()  <span class="comment"># normalized xywh # æ­¸ä¸€åŒ–çš„xywh</span></span><br><span class="line">                        line = (cls, *xywh, conf) <span class="keyword">if</span> save_conf <span class="keyword">else</span> (cls, *xywh)  <span class="comment"># label æ ¼å¼</span></span><br><span class="line">                        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">f&#x27;<span class="subst">&#123;txt_path&#125;</span>.txt&#x27;</span>, <span class="string">&#x27;a&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                            f.write((<span class="string">&#x27;%g &#x27;</span> * <span class="built_in">len</span>(line)).rstrip() % line + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> save_img <span class="keyword">or</span> save_crop <span class="keyword">or</span> view_img:  <span class="comment"># Add bbox to image</span></span><br><span class="line">                        c = <span class="built_in">int</span>(cls)  <span class="comment"># integer class</span></span><br><span class="line">                        label = <span class="literal">None</span> <span class="keyword">if</span> hide_labels <span class="keyword">else</span> (names[c] <span class="keyword">if</span> hide_conf <span class="keyword">else</span> <span class="string">f&#x27;<span class="subst">&#123;names[c]&#125;</span> <span class="subst">&#123;conf:<span class="number">.2</span>f&#125;</span>&#x27;</span>)</span><br><span class="line">                        annotator.box_label(xyxy, label, color=colors(c, <span class="literal">True</span>))</span><br><span class="line">                    <span class="keyword">if</span> save_crop:</span><br><span class="line">                        save_one_box(xyxy, imc, file=save_dir / <span class="string">&#x27;crops&#x27;</span> / names[c] / <span class="string">f&#x27;<span class="subst">&#123;p.stem&#125;</span>.jpg&#x27;</span>, BGR=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># ä¸²æµçµæœ</span></span><br><span class="line">            im0 = annotator.result()</span><br><span class="line">            <span class="keyword">if</span> view_img:</span><br><span class="line">                <span class="keyword">if</span> platform.system() == <span class="string">&#x27;Linux&#x27;</span> <span class="keyword">and</span> p <span class="keyword">not</span> <span class="keyword">in</span> windows:</span><br><span class="line">                    windows.append(p)</span><br><span class="line">                    cv2.namedWindow(<span class="built_in">str</span>(p), cv2.WINDOW_NORMAL | cv2.WINDOW_KEEPRATIO)  <span class="comment"># å…è¨±èª¿æ•´çª—å£å¤§å° (Linux)</span></span><br><span class="line">                    cv2.resizeWindow(<span class="built_in">str</span>(p), im0.shape[<span class="number">1</span>], im0.shape[<span class="number">0</span>])</span><br><span class="line">                cv2.imshow(<span class="built_in">str</span>(p), im0) <span class="comment">#(è¦–çª—åç¨±,é¡¯ç¤ºåœ–ç‰‡)</span></span><br><span class="line">                cv2.waitKey(<span class="number">1</span>)  <span class="comment"># 1 æ¯«ç§’.</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># ä¿å­˜çµæœï¼ˆå¸¶æª¢æ¸¬çš„åœ–åƒï¼‰</span></span><br><span class="line">            <span class="keyword">if</span> save_img:</span><br><span class="line">                <span class="keyword">if</span> dataset.mode == <span class="string">&#x27;image&#x27;</span>:</span><br><span class="line">                    cv2.imwrite(save_path, im0)</span><br><span class="line">                <span class="keyword">else</span>:  <span class="comment"># &#x27;video&#x27; or &#x27;stream&#x27;</span></span><br><span class="line">                    <span class="keyword">if</span> vid_path[i] != save_path:  <span class="comment"># new video</span></span><br><span class="line">                        vid_path[i] = save_path</span><br><span class="line">                        <span class="keyword">if</span> <span class="built_in">isinstance</span>(vid_writer[i], cv2.VideoWriter):</span><br><span class="line">                            vid_writer[i].release()  <span class="comment"># release previous video writer</span></span><br><span class="line">                        <span class="keyword">if</span> vid_cap:  <span class="comment"># video</span></span><br><span class="line">                            fps = vid_cap.get(cv2.CAP_PROP_FPS)</span><br><span class="line">                            w = <span class="built_in">int</span>(vid_cap.get(cv2.CAP_PROP_FRAME_WIDTH))</span><br><span class="line">                            h = <span class="built_in">int</span>(vid_cap.get(cv2.CAP_PROP_FRAME_HEIGHT))</span><br><span class="line">                        <span class="keyword">else</span>:  <span class="comment"># stream</span></span><br><span class="line">                            fps, w, h = <span class="number">30</span>, im0.shape[<span class="number">1</span>], im0.shape[<span class="number">0</span>]</span><br><span class="line">                        save_path = <span class="built_in">str</span>(Path(save_path).with_suffix(<span class="string">&#x27;.mp4&#x27;</span>))  <span class="comment"># åœ¨çµæœè¦–é »ä¸Šå¼·åˆ¶ *.mp4 å¾Œç¶´</span></span><br><span class="line">                        vid_writer[i] = cv2.VideoWriter(save_path, cv2.VideoWriter_fourcc(*<span class="string">&#x27;mp4v&#x27;</span>), fps, (w, h))</span><br><span class="line">                    vid_writer[i].write(im0)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># æå‡åœ¨è¨“ç·´æ™‚çš„æ•ˆç‡ï¼Œç”Ÿæˆçš„&quot;images&quot;å’Œ&quot;labels&quot;å¯ä»¥ç”¨ä¾†åŠ å¼·è¨“ç·´ã€‚</span></span><br><span class="line">        <span class="comment"># æ¢ä»¶æ˜¯è¾¨è­˜æ–°çš„åœ–ç‰‡æˆ–å½±ç‰‡ï¼Œåšç‚ºæ–°çš„è¨“ç·´æ¨£æœ¬</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(det):</span><br><span class="line">            ok_file=<span class="string">&quot;images&quot;</span> <span class="comment">#ã€æœ‰ã€‘è¾¨è­˜åˆ°çš„åœ–ï¼Œå­˜æ”¾çš„è³‡æ–™å¤¾åç¨±</span></span><br><span class="line">            img_path = <span class="built_in">str</span>(save_dir / ok_file / p.stem) +(<span class="string">&quot;_&quot;</span>+<span class="built_in">str</span>(seen)+<span class="string">&quot;.jpg&quot;</span>)  <span class="comment"># im.txt</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> os.path.isdir(<span class="built_in">str</span>(save_dir / ok_file)):</span><br><span class="line">                os.makedirs(<span class="built_in">str</span>(save_dir / ok_file))</span><br><span class="line">            cv2.imwrite(img_path,im0s) <span class="comment">#(å¯«å…¥è·¯å¾‘,åœ–ç‰‡) #im0sç‚ºè¾¨è­˜å‰åŸå§‹åœ– #im0ç‚ºè¾¨è­˜éå¾Œæœ‰çœ¶åœ–</span></span><br><span class="line">            box_file=<span class="string">&quot;images_box&quot;</span> <span class="comment">#ã€æœ‰ã€‘è¾¨è­˜åˆ°çš„åœ–ï¼Œå­˜æ”¾çš„è³‡æ–™å¤¾åç¨±</span></span><br><span class="line">            img_path = <span class="built_in">str</span>(save_dir / box_file / p.stem) +(<span class="string">&quot;_&quot;</span>+<span class="built_in">str</span>(seen)+<span class="string">&quot;.jpg&quot;</span>)  <span class="comment"># im.txt</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> os.path.isdir(<span class="built_in">str</span>(save_dir / box_file)):</span><br><span class="line">                os.makedirs(<span class="built_in">str</span>(save_dir / box_file))</span><br><span class="line">            cv2.imwrite(img_path,im0) <span class="comment">#(å¯«å…¥è·¯å¾‘,åœ–ç‰‡) #im0sç‚ºè¾¨è­˜å‰åŸå§‹åœ– #im0ç‚ºè¾¨è­˜éå¾Œæœ‰çœ¶åœ–</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># å¯ä»¥æ‰‹å‹•å°‡æ²’æœ‰è¾¨è­˜åˆ°çš„åœ–ï¼Œå¦å¤–é€²è¡Œlabelimgè™•ç†ã€‚</span></span><br><span class="line">            no_file=<span class="string">&quot;no_images&quot;</span> <span class="comment">#ã€æ²’æœ‰ã€‘è¾¨è­˜åˆ°çš„åœ–ï¼Œå­˜æ”¾çš„è³‡æ–™å¤¾åç¨±</span></span><br><span class="line">            img_path = <span class="built_in">str</span>(save_dir / no_file / p.stem) +(<span class="string">&quot;_&quot;</span>+<span class="built_in">str</span>(seen)+<span class="string">&quot;.jpg&quot;</span>)  <span class="comment"># im.txt</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> os.path.isdir(<span class="built_in">str</span>(save_dir / no_file)):</span><br><span class="line">                os.makedirs(<span class="built_in">str</span>(save_dir / no_file))</span><br><span class="line">            cv2.imwrite(img_path,im0s) <span class="comment">#(å¯«å…¥è·¯å¾‘,åœ–ç‰‡) #im0sç‚ºè¾¨è­˜å‰åŸå§‹åœ– #im0ç‚ºè¾¨è­˜éå¾Œæœ‰çœ¶åœ–</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Printæ™‚é–“ï¼ˆåƒ…æ¨ç†ï¼‰</span></span><br><span class="line">        LOGGER.info(<span class="string">f&quot;<span class="subst">&#123;s&#125;</span><span class="subst">&#123;<span class="string">&#x27;&#x27;</span> <span class="keyword">if</span> <span class="built_in">len</span>(det) <span class="keyword">else</span> <span class="string">&#x27;(No detections), &#x27;</span>&#125;</span><span class="subst">&#123;dt[<span class="number">1</span>].dt * <span class="number">1E3</span>:<span class="number">.1</span>f&#125;</span>ms&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Printçµæœ</span></span><br><span class="line">    t = <span class="built_in">tuple</span>(x.t / seen * <span class="number">1E3</span> <span class="keyword">for</span> x <span class="keyword">in</span> dt)  <span class="comment"># speeds per image # æ¯å¹…åœ–åƒçš„é€Ÿåº¦</span></span><br><span class="line">    LOGGER.info(<span class="string">f&#x27;Speed: %.1fms pre-process, %.1fms inference, %.1fms NMS per image at shape <span class="subst">&#123;(<span class="number">1</span>, <span class="number">3</span>, *imgsz)&#125;</span>&#x27;</span> % t)</span><br><span class="line">    <span class="keyword">if</span> save_txt <span class="keyword">or</span> save_img:</span><br><span class="line">        s = <span class="string">f&quot;\n<span class="subst">&#123;<span class="built_in">len</span>(<span class="built_in">list</span>(save_dir.glob(<span class="string">&#x27;labels/*.txt&#x27;</span>)))&#125;</span> labels saved to <span class="subst">&#123;save_dir / <span class="string">&#x27;labels&#x27;</span>&#125;</span>&quot;</span> <span class="keyword">if</span> save_txt <span class="keyword">else</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line">        LOGGER.info(<span class="string">f&quot;Results saved to <span class="subst">&#123;colorstr(<span class="string">&#x27;bold&#x27;</span>, save_dir)&#125;</span><span class="subst">&#123;s&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> update:</span><br><span class="line">        strip_optimizer(weights[<span class="number">0</span>])  <span class="comment"># æ›´æ–°æ¨¡å‹ï¼ˆä¿®å¾© SourceChangeWarningï¼‰</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">parse_opt</span>():</span><br><span class="line">    parser = argparse.ArgumentParser()</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--weights&#x27;</span>, nargs=<span class="string">&#x27;+&#x27;</span>, <span class="built_in">type</span>=<span class="built_in">str</span>, default=ROOT / <span class="string">&#x27;yolov5s.pt&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;ï¼ˆå¯é¸ï¼‰æ¨¡å‹è·¯å¾‘æˆ– triton URL&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--source&#x27;</span>, <span class="built_in">type</span>=<span class="built_in">str</span>, default=ROOT / <span class="string">&#x27;data/images&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;æ–‡ä»¶/ç›®éŒ„/URL/glob/screen/0ï¼ˆç¶²çµ¡æ”åƒé ­ï¼‰&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--data&#x27;</span>, <span class="built_in">type</span>=<span class="built_in">str</span>, default=ROOT / <span class="string">&#x27;data/coco128.yaml&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;ï¼ˆå¯é¸ï¼‰dataset.yaml è·¯å¾‘&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--imgsz&#x27;</span>, <span class="string">&#x27;--img&#x27;</span>, <span class="string">&#x27;--img-size&#x27;</span>, nargs=<span class="string">&#x27;+&#x27;</span>, <span class="built_in">type</span>=<span class="built_in">int</span>, default=[<span class="number">480</span>,<span class="number">640</span>], <span class="built_in">help</span>=<span class="string">&#x27;æ¨ç†å¤§å° h,w&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--conf-thres&#x27;</span>, <span class="built_in">type</span>=<span class="built_in">float</span>, default=<span class="number">0.25</span>, <span class="built_in">help</span>=<span class="string">&#x27;confidence é–¾å€¼&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--iou-thres&#x27;</span>, <span class="built_in">type</span>=<span class="built_in">float</span>, default=<span class="number">0.45</span>, <span class="built_in">help</span>=<span class="string">&#x27;NMS IoU é–¾å€¼&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--max-det&#x27;</span>, <span class="built_in">type</span>=<span class="built_in">int</span>, default=<span class="number">1000</span>, <span class="built_in">help</span>=<span class="string">&#x27;æ¯å¼µåœ–ç‰‡çš„æœ€å¤§æª¢æ¸¬æ•¸&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--device&#x27;</span>, default=<span class="string">&#x27;&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;cuda è¨­å‚™ï¼Œå³ 0 æˆ– 0,1,2,3 æˆ– cpu&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--view-img&#x27;</span>, action=<span class="string">&#x27;store_true&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;é¡¯ç¤ºè¾¨è­˜çµæœ&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--save-txt&#x27;</span>, action=<span class="string">&#x27;store_true&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;å°‡çµæœä¿å­˜åˆ° *.txt&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--save-conf&#x27;</span>, action=<span class="string">&#x27;store_true&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;åœ¨ --save-txt æ¨™ç±¤ä¸­ä¿å­˜ä¿¡å¿ƒ&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--save-crop&#x27;</span>, action=<span class="string">&#x27;store_true&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;ä¿å­˜è£å‰ªçš„é æ¸¬æ¡†&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--nosave&#x27;</span>, action=<span class="string">&#x27;store_true&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;ä¸ä¿å­˜åœ–ç‰‡/è¦–é »&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--classes&#x27;</span>, nargs=<span class="string">&#x27;+&#x27;</span>, <span class="built_in">type</span>=<span class="built_in">int</span>, <span class="built_in">help</span>=<span class="string">&#x27;æŒ‰é¡åˆ¥éæ¿¾ï¼š--classes 0ï¼Œæˆ–--classes 0 2 3&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--agnostic-nms&#x27;</span>, action=<span class="string">&#x27;store_true&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;class-agnostic NMS&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--augment&#x27;</span>, action=<span class="string">&#x27;store_true&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;å¢å¼·æ¨ç†&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--visualize&#x27;</span>, action=<span class="string">&#x27;store_true&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;å¯è¦–åŒ–ç‰¹å¾µ&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--update&#x27;</span>, action=<span class="string">&#x27;store_true&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;æ›´æ–°æ‰€æœ‰æ¨¡å‹&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--project&#x27;</span>, default=ROOT / <span class="string">&#x27;runs/detect&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;å°‡çµæœä¿å­˜åˆ°é …ç›®/åç¨±&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--name&#x27;</span>, default=<span class="string">&#x27;exp&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;å°‡çµæœä¿å­˜åˆ°é …ç›®/åç¨±&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--exist-ok&#x27;</span>, action=<span class="string">&#x27;store_true&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;ç¾æœ‰é …ç›®/åç¨±å¯ä»¥ï¼Œä¸è¦å¢åŠ &#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--line-thickness&#x27;</span>, default=<span class="number">1</span>, <span class="built_in">type</span>=<span class="built_in">int</span>, <span class="built_in">help</span>=<span class="string">&#x27;é‚Šç•Œæ¡†åšåº¦ï¼ˆpixelsåƒç´ ï¼‰&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--hide-labels&#x27;</span>, default=<span class="literal">False</span>, action=<span class="string">&#x27;store_true&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;éš±è—æ¨™ç±¤&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--hide-conf&#x27;</span>, default=<span class="literal">False</span>, action=<span class="string">&#x27;store_true&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;éš±è—confidences&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--half&#x27;</span>, action=<span class="string">&#x27;store_true&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;ä½¿ç”¨FP16åŠç²¾åº¦æ¨æ–·&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--dnn&#x27;</span>, action=<span class="string">&#x27;store_true&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;ä½¿ç”¨OpenCV DNNé€²è¡ŒONNXæ¨æ–·&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--vid-stride&#x27;</span>, <span class="built_in">type</span>=<span class="built_in">int</span>, default=<span class="number">1</span>, <span class="built_in">help</span>=<span class="string">&#x27;è¦–é »å¹€ç‡æ­¥å¹…&#x27;</span>)</span><br><span class="line">    opt = parser.parse_args()</span><br><span class="line">    opt.imgsz *= <span class="number">2</span> <span class="keyword">if</span> <span class="built_in">len</span>(opt.imgsz) == <span class="number">1</span> <span class="keyword">else</span> <span class="number">1</span>  <span class="comment"># expand</span></span><br><span class="line">    print_args(<span class="built_in">vars</span>(opt))</span><br><span class="line">    <span class="keyword">return</span> opt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>(<span class="params">opt</span>):</span><br><span class="line">    check_requirements(exclude=(<span class="string">&#x27;tensorboard&#x27;</span>, <span class="string">&#x27;thop&#x27;</span>))</span><br><span class="line">    run(**<span class="built_in">vars</span>(opt))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    opt = parse_opt()</span><br><span class="line">    main(opt)</span><br></pre></td></tr></table></figure>

</details>

<hr>
<h1 id="å¦‚æœé‡åˆ°éŒ¯èª¤å•é¡Œï¼Œå†ä¾†åƒè€ƒé€™é‚Š"><a href="#å¦‚æœé‡åˆ°éŒ¯èª¤å•é¡Œï¼Œå†ä¾†åƒè€ƒé€™é‚Š" class="headerlink" title="å¦‚æœé‡åˆ°éŒ¯èª¤å•é¡Œï¼Œå†ä¾†åƒè€ƒé€™é‚Š"></a>å¦‚æœé‡åˆ°éŒ¯èª¤å•é¡Œï¼Œå†ä¾†åƒè€ƒé€™é‚Š</h1><ol>
<li><code>OMP: Error #15: Initializing libomp.dylib, but found libiomp5.dylib already initialize</code><blockquote>
<ul>
<li>è¾¦æ³•ï¼‘ï¼š<br>åœ¨åŸ·è¡Œ<code>train.py</code>ç¨‹å¼å…§ï¼Œæœ€ä¸Šæ–¹æ·»åŠ è¼¸å…¥æ­¤ä»£ç¢¼ï¼š <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line">os.environ[<span class="string">&quot;KMP_DUPLICATE_LIB_OK&quot;</span>]=<span class="string">&quot;TRUE&quot;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>ç¤ºæ„åœ–ï¼š<br> <img src="https://i.imgur.com/JJc2Ksx.png"></li>
</ul>
</blockquote>
</li>
<li>è¾¦æ³•ï¼’ï¼š<br>åˆªé™¤<code>\Anaconda3\pkgs</code>ç›®éŒ„ä¸‹ï¼ŒåŒ…å«<code>libomp.dylib</code>æª”æ¡ˆçš„æ‰€æœ‰è³‡æ–™å¤¾ã€‚<blockquote>
<ul>
<li>PKGSçš„æ¦‚å¿µï¼š<br> åœ¨anacondaä¸­ï¼Œæœ€å®‰å…¨çš„å®‰è£å’Œå‡ç´šå‘½ä»¤æ˜¯<code>conda install</code>ï¼Œè€Œpythonä¸­æ˜¯<code>pip install</code>ï¼Œ<br> ä½†åœ¨anacondaä¸‹ä¾ç„¶å¯ä»¥ä½¿ç”¨pipå‡ç´šï¼Œé€™æ¨£ä¸€äº›ä¾è³´å¯èƒ½æœƒå› ç‚ºæ›´æ–°å¾Œçš„ç‰ˆæœ¬éé«˜å‡ºç¾ç•°å¸¸ï¼Œæ‰€ä»¥åœ¨å®‰è£åŒ…çš„æ™‚å€™ï¼Œå„ªå…ˆé¸æ“‡<code>conda install</code>ã€‚<br> åœ¨condaçš„è¨­è¨ˆä¸­ï¼Œç›®éŒ„â€™pkgsâ€™æ˜¯ä¸‹è¼‰ã€å­˜æ”¾ç·©å­˜ï¼Œä»¥åŠæå–ä¸‹è¼‰çš„condaåŒ…çš„åœ°æ–¹ã€‚åŒæ™‚ï¼Œanacondaä¸€èµ·æ”œå¸¶çš„åŒ…ä¹Ÿæœƒæ”¾åœ¨é€™è£¡ã€‚<br> å®ƒæœ‰ä¸€å€‹éå¸¸é—œéµçš„ä½œç”¨ï¼šæˆ‘å€‘åœ¨æ§‹å»ºä¸€äº›<code>envs</code>(ç’°å¢ƒ)çš„æ™‚å€™ï¼Œå°ä¸€äº›åŒ…çš„ä¾è³´æœƒé€šéç¡¬ç›¤éˆæ¥éˆæ¥åˆ°<code>pkgsç›®éŒ„</code>ï¼Œé€™æ¨£è™›æ“¬ç’°å¢ƒç”Ÿæˆçš„é€Ÿåº¦å¤§å¤§åŠ å¿«ï¼Œä½”ç”¨ç©ºé–“å°±å¤§å¤§æ¸›å°äº†ï¼</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
</li>
</ol>
<hr>
<ol start="2">
<li><code>UnicodeDecodeError: &#39;cp950&#39; codec can&#39;t decode byte 0x93 in position 25: illegal multibyte sequence</code><br>å¦‚æœå‡ºç¾ä»¥ä¸ŠéŒ¯èª¤ï¼Œé€™æ˜¯Windowsçš„å•é¡Œï¼Œæ‰€ä»¥æˆ‘å€‘å¦‚æœè¦é¿å…é¡ä¼¼å•é¡Œç™¼ç”Ÿï¼Œç›¡é‡åœ¨è¦ç·¨è¼¯çš„<code>.yaml</code>æª”æ¡ˆè£¡ä¸è¦æ·»åŠ ä»»ä½•<font color="red"><del>ä¸­æ–‡(Chinese)</del></font>ã€‚</li>
</ol>
<ul>
<li><code>æ³¨æ„ï¼šæª”æ¡ˆå¿…é ˆç‚ºUTF-8çš„ç·¨ç¢¼</code><br>  <img src="https://i.imgur.com/wELOdNS.png"></li>
<li>å¯åˆ°<code>æ§åˆ¶å°</code>&gt;<code>æ™‚é˜å’Œå€åŸŸ</code>&gt;<code>åœ°å€</code>&gt;<code>ç³»çµ±ç®¡ç†</code>&gt;<code>è®Šæ›´ç³»çµ±åœ°å€è¨­å®š</code>&gt; <code>Bata:ä½¿ç”¨Unicode UTF-8æä¾›å…¨çƒèªè¨€æ”¯æ´</code><br>çš„<strong>é¸é …æ‰“å‹¾</strong>å³å¯ã€‚<br>  <img src="https://i.imgur.com/Alh3Pv5.png"></li>
</ul>
<hr>
<ol start="3">
<li><code>export GIT_PYTHON_REFRESH=quiet</code><br>  å¦‚æœå‡ºç¾é€™å€‹éŒ¯èª¤ï¼Œä»£è¡¨ç¼ºä¹å®‰è£gitçš„æ¨¡çµ„ï¼Œè«‹ç”¨ä»¥ä¸‹CondaæŒ‡ä»¤å®‰è£ï¼š  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda install git</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h1 id="æœ¬ç«™ä½œè€…ä½¿ç”¨YOLOé–‹ç™¼ç´€éŒ„"><a href="#æœ¬ç«™ä½œè€…ä½¿ç”¨YOLOé–‹ç™¼ç´€éŒ„" class="headerlink" title="æœ¬ç«™ä½œè€…ä½¿ç”¨YOLOé–‹ç™¼ç´€éŒ„"></a>æœ¬ç«™ä½œè€…ä½¿ç”¨YOLOé–‹ç™¼ç´€éŒ„</h1><h2 id="æå‡è¨“ç·´æ•ˆç›Š"><a href="#æå‡è¨“ç·´æ•ˆç›Š" class="headerlink" title="æå‡è¨“ç·´æ•ˆç›Š"></a>æå‡è¨“ç·´æ•ˆç›Š</h2><ul>
<li>å¦‚ä¸‹æ–¹ä»£ç¢¼æ‰€ç¤ºï¼š<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æå‡åœ¨è¨“ç·´æ™‚çš„æ•ˆç‡ï¼Œç”Ÿæˆçš„&quot;images&quot;å’Œ&quot;labels&quot;å¯ä»¥ç”¨ä¾†åŠ å¼·è¨“ç·´ã€‚</span></span><br><span class="line"><span class="comment"># æ¢ä»¶æ˜¯è¾¨è­˜æ–°çš„åœ–ç‰‡æˆ–å½±ç‰‡ï¼Œåšç‚ºæ–°çš„è¨“ç·´æ¨£æœ¬</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(det):</span><br><span class="line">    ok_file=<span class="string">&quot;images&quot;</span> <span class="comment">#ã€æœ‰ã€‘è¾¨è­˜åˆ°çš„åœ–ï¼Œå­˜æ”¾çš„è³‡æ–™å¤¾åç¨±</span></span><br><span class="line">    img_path = <span class="built_in">str</span>(save_dir / ok_file / p.stem) +(<span class="string">&quot;_&quot;</span>+<span class="built_in">str</span>(seen)+<span class="string">&quot;.jpg&quot;</span>)  <span class="comment"># im.txt</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.isdir(<span class="built_in">str</span>(save_dir / ok_file)):</span><br><span class="line">        os.makedirs(<span class="built_in">str</span>(save_dir / ok_file))</span><br><span class="line">    cv2.imwrite(img_path,im0s) <span class="comment">#(å¯«å…¥è·¯å¾‘,åœ–ç‰‡) #im0sç‚ºè¾¨è­˜å‰åŸå§‹åœ– #im0ç‚ºè¾¨è­˜éå¾Œæœ‰çœ¶åœ–</span></span><br><span class="line">    box_file=<span class="string">&quot;images_box&quot;</span> <span class="comment">#ã€æœ‰ã€‘è¾¨è­˜åˆ°çš„åœ–ï¼Œå­˜æ”¾çš„è³‡æ–™å¤¾åç¨±</span></span><br><span class="line">    img_path = <span class="built_in">str</span>(save_dir / box_file / p.stem) +(<span class="string">&quot;_&quot;</span>+<span class="built_in">str</span>(seen)+<span class="string">&quot;.jpg&quot;</span>)  <span class="comment"># im.txt</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.isdir(<span class="built_in">str</span>(save_dir / box_file)):</span><br><span class="line">        os.makedirs(<span class="built_in">str</span>(save_dir / box_file))</span><br><span class="line">    cv2.imwrite(img_path,im0) <span class="comment">#(å¯«å…¥è·¯å¾‘,åœ–ç‰‡) #im0sç‚ºè¾¨è­˜å‰åŸå§‹åœ– #im0ç‚ºè¾¨è­˜éå¾Œæœ‰çœ¶åœ–</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="comment"># å¯ä»¥æ‰‹å‹•å°‡æ²’æœ‰è¾¨è­˜åˆ°çš„åœ–ï¼Œå¦å¤–é€²è¡Œlabelimgè™•ç†ã€‚</span></span><br><span class="line">    no_file=<span class="string">&quot;no_images&quot;</span> <span class="comment">#ã€æ²’æœ‰ã€‘è¾¨è­˜åˆ°çš„åœ–ï¼Œå­˜æ”¾çš„è³‡æ–™å¤¾åç¨±</span></span><br><span class="line">    img_path = <span class="built_in">str</span>(save_dir / no_file / p.stem) +(<span class="string">&quot;_&quot;</span>+<span class="built_in">str</span>(seen)+<span class="string">&quot;.jpg&quot;</span>)  <span class="comment"># im.txt</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.isdir(<span class="built_in">str</span>(save_dir / no_file)):</span><br><span class="line">        os.makedirs(<span class="built_in">str</span>(save_dir / no_file))</span><br><span class="line">    cv2.imwrite(img_path,im0s) <span class="comment">#(å¯«å…¥è·¯å¾‘,åœ–ç‰‡) #im0sç‚ºè¾¨è­˜å‰åŸå§‹åœ– #im0ç‚ºè¾¨è­˜éå¾Œæœ‰çœ¶åœ–</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="YOLOæ¡†å–æŒ‡å®šè§£æåº¦çš„åœ–ï¼Œå¯ä½œç‚ºå¾ŒçºŒCNNè¨“ç·´"><a href="#YOLOæ¡†å–æŒ‡å®šè§£æåº¦çš„åœ–ï¼Œå¯ä½œç‚ºå¾ŒçºŒCNNè¨“ç·´" class="headerlink" title="YOLOæ¡†å–æŒ‡å®šè§£æåº¦çš„åœ–ï¼Œå¯ä½œç‚ºå¾ŒçºŒCNNè¨“ç·´"></a>YOLOæ¡†å–æŒ‡å®šè§£æåº¦çš„åœ–ï¼Œå¯ä½œç‚ºå¾ŒçºŒCNNè¨“ç·´</h2><p>å°‡ä»¥ä¸‹ä»£ç¢¼ï¼Œæ”¾å…¥åˆ°<code>det[:, :4] = scale_boxes(im.shape[2:], det[:, :4], im0.shape).round()</code>æ­¤è¡Œçš„ä¸Šæ–¹ï¼Œ<code>high</code>å’Œ<code>wight</code>å¯ä¾å€‹äººéœ€æ±‚é€²è¡Œèª¿æ•´ã€‚</p>
<ul>
<li>å¦‚ä¸‹æ–¹ä»£ç¢¼æ‰€ç¤ºï¼š<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(det):</span><br><span class="line">    <span class="comment">#####ä»¥ä¸‹ä»£ç¢¼#####</span></span><br><span class="line">    <span class="comment">#èª¿æ•´è£å‰ªå¾Œçš„é æ¸¬åœ– </span></span><br><span class="line">    <span class="comment">#è£æ¸›ç¯„åœè‹¥æ’åˆ°åœ–ç‰‡çš„é‚Šç·£ï¼Œå°ºå¯¸æœƒæœ‰è®ŠåŒ–ã€‚</span></span><br><span class="line">    high=<span class="number">50</span>  <span class="comment">#åœ–ç‰‡è£æ¸›çš„èª¿æ•´å€¼æœ€ä½ç‚º12ï¼Œè‹¥ä½æ–¼ 12 è£æ¸›å°ºå¯¸æœƒæœ‰éé æœŸçµæœ</span></span><br><span class="line">    wight=<span class="number">50</span> <span class="comment">#åœ–ç‰‡è£æ¸›çš„èª¿æ•´å€¼æœ€ä½ç‚º12ï¼Œè‹¥ä½æ–¼ 12 è£æ¸›å°ºå¯¸æœƒæœ‰éé æœŸçµæœ</span></span><br><span class="line">    <span class="comment"># è«‹å‹¿è®Šæ›´</span></span><br><span class="line">    ax=det[:, <span class="number">0</span>:<span class="number">1</span>] ; ay=det[:, <span class="number">1</span>:<span class="number">2</span>]</span><br><span class="line">    bx=det[:, <span class="number">2</span>:<span class="number">3</span>] ; by=det[:, <span class="number">3</span>:<span class="number">4</span>]</span><br><span class="line">    centerX=ax+((bx-ax)/<span class="number">2</span>)</span><br><span class="line">    centerY=ay+((by-ay)/<span class="number">2</span>)</span><br><span class="line">    <span class="comment">#print(NewAX,NewAY,NewBX,NewBY)</span></span><br><span class="line">    det[:, <span class="number">0</span>:<span class="number">1</span>]=<span class="built_in">int</span>((centerX)-((wight-<span class="number">11</span>)/<span class="number">2</span>))</span><br><span class="line">    det[:, <span class="number">1</span>:<span class="number">2</span>]=<span class="built_in">int</span>((centerY)-((high-<span class="number">11</span>)/<span class="number">2</span>))</span><br><span class="line">    det[:, <span class="number">2</span>:<span class="number">3</span>]=<span class="built_in">int</span>((centerX)+((wight-<span class="number">11</span>)/<span class="number">2</span>))</span><br><span class="line">    det[:, <span class="number">3</span>:<span class="number">4</span>]=<span class="built_in">int</span>((centerY)+((high-<span class="number">11</span>)/<span class="number">2</span>))</span><br><span class="line">    <span class="comment">#####ä»¥ä¸Šä»£ç¢¼#####</span></span><br><span class="line">    <span class="comment"># å°‡æ¡†å¾ img_size é‡æ–°ç¸®æ”¾ç‚º im0 å¤§å°</span></span><br><span class="line">    det[:, :<span class="number">4</span>] = scale_boxes(im.shape[<span class="number">2</span>:], det[:, :<span class="number">4</span>], im0.shape).<span class="built_in">round</span>()</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="å»ºç«‹TCP-x2F-IPé€šè¨Š"><a href="#å»ºç«‹TCP-x2F-IPé€šè¨Š" class="headerlink" title="å»ºç«‹TCP&#x2F;IPé€šè¨Š"></a>å»ºç«‹TCP&#x2F;IPé€šè¨Š</h2>
    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>ä½œè€…ï¼š </strong>Yong Cheng
  </li>
  <li class="post-copyright-link">
    <strong>æ–‡ç« é€£çµï¼š</strong>
    <a href="https://pkpk26261.github.io/2022/11/24/YOLOv5%E7%9A%84%E4%BD%BF%E7%94%A8%E7%B4%80%E9%8C%84/" title="YOLOv5 çš„ ä½¿ç”¨ç´€éŒ„">https://pkpk26261.github.io/2022/11/24/YOLOv5çš„ä½¿ç”¨ç´€éŒ„/</a>
  </li>
  <li class="post-copyright-license">
    <strong>ç‰ˆæ¬Šè²æ˜ï¼š </strong>æœ¬ç¶²èªŒæ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ¥è²æ˜å¤–ï¼Œå‡æ¡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/deed.zh_TW" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-ND</a> è¨±å¯å”è­°ã€‚è½‰è¼‰è«‹è¨»æ˜å‡ºè™•ï¼
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Python/" rel="tag"># Python</a>
              <a href="/tags/YOLO/" rel="tag"># YOLO</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/11/17/Python%E5%B0%81%E8%A3%9Dexe/" rel="prev" title="Pythonå°è£exeæ‡‰ç”¨ç¨‹å¼">
      <i class="fa fa-chevron-left"></i> Pythonå°è£exeæ‡‰ç”¨ç¨‹å¼
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/12/02/QT5-GUI%20%E6%95%99%E5%AD%B8%E5%BC%95%E5%B0%8E/" rel="next" title="QT5 Pythonçš„GUIä»‹é¢ ä½¿ç”¨ç´€éŒ„">
      QT5 Pythonçš„GUIä»‹é¢ ä½¿ç”¨ç´€éŒ„ <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®éŒ„
        </li>
        <li class="sidebar-nav-overview">
          æœ¬ç«™æ¦‚è¦
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%96%8B%E5%A7%8B"><span class="nav-number">1.</span> <span class="nav-text">é–‹å§‹</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%BB%BA%E7%AB%8BYOLOv5%E7%92%B0%E5%A2%83"><span class="nav-number">2.</span> <span class="nav-text">å»ºç«‹YOLOv5ç’°å¢ƒ</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8labelimg%E6%A1%86%E5%9C%96%E7%89%87%E5%BB%BA%E7%AB%8B%E6%A8%A3%E6%9C%AC"><span class="nav-number">3.</span> <span class="nav-text">ä½¿ç”¨labelimgæ¡†åœ–ç‰‡å»ºç«‹æ¨£æœ¬</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%BB%BA%E7%AB%8B%E6%96%B0%E5%A2%9EAI%E8%BE%A8%E8%AD%98%E7%9A%84%E5%9C%96%E7%89%87%E6%A8%A3%E6%9C%AC"><span class="nav-number">4.</span> <span class="nav-text">å»ºç«‹æ–°å¢AIè¾¨è­˜çš„åœ–ç‰‡æ¨£æœ¬</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%A8%93%E7%B7%B4-amp-%E9%A9%97%E8%AD%89%E5%9C%96%E7%89%87"><span class="nav-number">5.</span> <span class="nav-text">è¨“ç·´&amp;é©—è­‰åœ–ç‰‡</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%A1%86%E5%A5%BD%E7%9A%84%E5%9C%96%E7%89%87%E3%80%90%E8%A8%93%E7%B7%B4%E3%80%91"><span class="nav-number">6.</span> <span class="nav-text">æ¡†å¥½çš„åœ–ç‰‡ã€è¨“ç·´ã€‘</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A8%93%E7%B7%B4%E8%87%AA%E5%AE%9A%E7%BE%A9%E6%95%B8%E6%93%9A"><span class="nav-number">6.1.</span> <span class="nav-text">è¨“ç·´è‡ªå®šç¾©æ•¸æ“š</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%81%B8%E6%93%87%E5%9E%8B%E8%99%9F"><span class="nav-number">6.2.</span> <span class="nav-text">é¸æ“‡å‹è™Ÿ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%96%8B%E5%A7%8B%E8%A8%93%E7%B7%B4"><span class="nav-number">6.3.</span> <span class="nav-text">é–‹å§‹è¨“ç·´</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#train-py"><span class="nav-number">6.4.</span> <span class="nav-text">train.py</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%9C%96%E7%89%87-amp-%E5%BD%B1%E7%89%87-amp-%E4%B8%B2%E6%B5%81%E3%80%90%E6%AA%A2%E6%B8%AC%E3%80%91"><span class="nav-number">7.</span> <span class="nav-text">åœ–ç‰‡&amp;å½±ç‰‡&amp;ä¸²æµã€æª¢æ¸¬ã€‘</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#detect-py"><span class="nav-number">7.1.</span> <span class="nav-text">detect.py</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%A6%82%E6%9E%9C%E9%81%87%E5%88%B0%E9%8C%AF%E8%AA%A4%E5%95%8F%E9%A1%8C%EF%BC%8C%E5%86%8D%E4%BE%86%E5%8F%83%E8%80%83%E9%80%99%E9%82%8A"><span class="nav-number">8.</span> <span class="nav-text">å¦‚æœé‡åˆ°éŒ¯èª¤å•é¡Œï¼Œå†ä¾†åƒè€ƒé€™é‚Š</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%9C%AC%E7%AB%99%E4%BD%9C%E8%80%85%E4%BD%BF%E7%94%A8YOLO%E9%96%8B%E7%99%BC%E7%B4%80%E9%8C%84"><span class="nav-number">9.</span> <span class="nav-text">æœ¬ç«™ä½œè€…ä½¿ç”¨YOLOé–‹ç™¼ç´€éŒ„</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8F%90%E5%8D%87%E8%A8%93%E7%B7%B4%E6%95%88%E7%9B%8A"><span class="nav-number">9.1.</span> <span class="nav-text">æå‡è¨“ç·´æ•ˆç›Š</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#YOLO%E6%A1%86%E5%8F%96%E6%8C%87%E5%AE%9A%E8%A7%A3%E6%9E%90%E5%BA%A6%E7%9A%84%E5%9C%96%EF%BC%8C%E5%8F%AF%E4%BD%9C%E7%82%BA%E5%BE%8C%E7%BA%8CCNN%E8%A8%93%E7%B7%B4"><span class="nav-number">9.2.</span> <span class="nav-text">YOLOæ¡†å–æŒ‡å®šè§£æåº¦çš„åœ–ï¼Œå¯ä½œç‚ºå¾ŒçºŒCNNè¨“ç·´</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BB%BA%E7%AB%8BTCP-x2F-IP%E9%80%9A%E8%A8%8A"><span class="nav-number">9.3.</span> <span class="nav-text">å»ºç«‹TCP&#x2F;IPé€šè¨Š</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">

	<a href="/"> <!--æ·»åŠ æ­¤è¡Œä»£ç¢¼-->
    		<img class="site-author-image" itemprop="image" alt="Yong Cheng"
      	src="/images/lanlancat.gif">
	</a> <!--æ·»åŠ æ­¤è¡Œä»£ç¢¼-->
  
  <p class="site-author-name" itemprop="name">Yong Cheng</p>
  <div class="site-description" itemprop="description">æˆ‘ä¸€æ—¦æ±ºå®šï¼Œå°±ç‚ºäº†å¤¢å‰é€²ğŸ‘</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">20</span>
          <span class="site-state-item-name">æ–‡ç« </span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">åˆ†é¡</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">14</span>
        <span class="site-state-item-name">æ¨™ç±¤</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="mailto:a0979488285@gmail.com" title="E-Mail â†’ mailto:a0979488285@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://github.com/pkpk26261" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;pkpk26261" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.youtube.com/channel/UCdCh7GL1WCTsXJ-6PkTBZZw?view_as=subscriber" title="YouTube â†’ https:&#x2F;&#x2F;www.youtube.com&#x2F;channel&#x2F;UCdCh7GL1WCTsXJ-6PkTBZZw?view_as&#x3D;subscriber" rel="noopener" target="_blank"><i class="fab fa-youtube fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://line.me/ti/p/XGjZN3WZhs" title="LINE â†’ https:&#x2F;&#x2F;line.me&#x2F;ti&#x2F;p&#x2F;XGjZN3WZhs" rel="noopener" target="_blank"><i class="fab fa-line fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://discord.gg/vber8KV" title="Discord â†’ https:&#x2F;&#x2F;discord.gg&#x2F;vber8KV" rel="noopener" target="_blank"><i class="fab fa-discord fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.facebook.com/profile.php?id=100002320400912" title="Facebook â†’ https:&#x2F;&#x2F;www.facebook.com&#x2F;profile.php?id&#x3D;100002320400912" rel="noopener" target="_blank"><i class="fab fa-facebook fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.instagram.com/pkpk26261/?hl=zh-tw" title="Instagram â†’ https:&#x2F;&#x2F;www.instagram.com&#x2F;pkpk26261&#x2F;?hl&#x3D;zh-tw" rel="noopener" target="_blank"><i class="fab fa-instagram fa-fw"></i></a>
      </span>
  </div>



  <!--æ·»åŠ æ­¤è¡Œä»£ç¢¼-->
  <div class="video-container" style="padding-top: 5%;">
  <iframe width="214" height="120" src="https://www.youtube.com/embed/videoseries?rel=0&autoplay=1&loop=1&list=PLk9vv5Pa7hdbzqOdIklJNBNnfj478TyeC&amp;showinfo=0" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
  </div>
  <!--æ·»åŠ æ­¤è¡Œä»£ç¢¼-->
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/deed.zh_TW" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-nd.svg" alt="Creative Commons"></a>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fab fa-line fa-fw"></i>
      LINE ç¤¾ç¾¤åŠ å…¥é€£çµï¼š&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://line.me/ti/g2/AA48uijUET5-xBolEFBPsA?utm_source=invitation&utm_medium=link_copy&utm_campaign=default" title="https:&#x2F;&#x2F;line.me&#x2F;ti&#x2F;g2&#x2F;AA48uijUET5-xBolEFBPsA?utm_source&#x3D;invitation&amp;utm_medium&#x3D;link_copy&amp;utm_campaign&#x3D;default" rel="noopener" target="_blank"><div align="right">Python Taiwan äº¤æµèšæœƒ &emsp;&ensp;</div></a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://line.me/ti/g2/P-Fm0gxHbgonmsTAUHB1sA?utm_source=invitation&utm_medium=link_copy&utm_campaign=default" title="https:&#x2F;&#x2F;line.me&#x2F;ti&#x2F;g2&#x2F;P-Fm0gxHbgonmsTAUHB1sA?utm_source&#x3D;invitation&amp;utm_medium&#x3D;link_copy&amp;utm_campaign&#x3D;default" rel="noopener" target="_blank"><div align="right">C# Taiwan äº¤æµèšæœƒ &emsp;&ensp;</div></a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://line.me/ti/g2/HCn_HLQvlZMGesiMY-Gp2A?utm_source=invitation&utm_medium=link_copy&utm_campaign=default" title="https:&#x2F;&#x2F;line.me&#x2F;ti&#x2F;g2&#x2F;HCn_HLQvlZMGesiMY-Gp2A?utm_source&#x3D;invitation&amp;utm_medium&#x3D;link_copy&amp;utm_campaign&#x3D;default" rel="noopener" target="_blank"><div align="right">C/C++ Taiwan äº¤æµèšæœƒ &emsp;&ensp;</div></a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://line.me/ti/g2/AcgdbapQ8GgyC_xju3VXbA?utm_source=invitation&utm_medium=link_copy&utm_campaign=default" title="https:&#x2F;&#x2F;line.me&#x2F;ti&#x2F;g2&#x2F;AcgdbapQ8GgyC_xju3VXbA?utm_source&#x3D;invitation&amp;utm_medium&#x3D;link_copy&amp;utm_campaign&#x3D;default" rel="noopener" target="_blank"><div align="right">Java Taiwan äº¤æµèšæœƒ &emsp;&ensp;</div></a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2019 â€“ 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Yong Cheng</span>
</div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>


  <script defer src="/lib/three/three.min.js"></script>
    <script defer src="/lib/three/three-waves.min.js"></script>
    <script defer src="/lib/three/canvas_lines.min.js"></script>


  




  
<script src="/js/local-search.js"></script>









<script>
document.querySelectorAll('.pdfobject-container').forEach(element => {
  let url = element.dataset.target;
  let pdfOpenParams = {
    navpanes : 0,
    toolbar  : 0,
    statusbar: 0,
    pagemode : 'thumbs',
    view     : 'FitH'
  };
  let pdfOpenFragment = '#' + Object.entries(pdfOpenParams).map(([key, value]) => `${key}=${encodeURIComponent(value)}`).join('&');
  let fullURL = `/lib/pdf/web/viewer.html?file=${encodeURIComponent(url)}${pdfOpenFragment}`;

  if (NexT.utils.supportsPDFs()) {
    element.innerHTML = `<embed class="pdfobject" src="${url + pdfOpenFragment}" type="application/pdf" style="height: ${element.dataset.height};">`;
  } else {
    element.innerHTML = `<iframe src="${fullURL}" style="height: ${element.dataset.height};" frameborder="0"></iframe>`;
  }
});
</script>




  

  

</body>
</html>
